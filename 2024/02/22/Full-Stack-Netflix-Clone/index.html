<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":5,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Netflix Clonetech stack Frontend: React Server-side Rendering: Next.js Styling: Tailwind CSS Data abstraction layer: Prisma Storage: MongoDB Authentication: NextAuth Deploy: Vercel Typescript the enti">
<meta property="og:type" content="article">
<meta property="og:title" content="Full Stack Netflix Clone">
<meta property="og:url" content="http://example.com/2024/02/22/Full-Stack-Netflix-Clone/index.html">
<meta property="og:site_name" content="YifanChen&#39;s Blog">
<meta property="og:description" content="Netflix Clonetech stack Frontend: React Server-side Rendering: Next.js Styling: Tailwind CSS Data abstraction layer: Prisma Storage: MongoDB Authentication: NextAuth Deploy: Vercel Typescript the enti">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/yfchenkeepgoing/image/blob/main/Snipaste_2024-02-25_04-32-09.png?raw=true">
<meta property="og:image" content="https://github.com/yfchenkeepgoing/image/blob/main/Snipaste_2024-02-27_04-40-46.png?raw=true">
<meta property="og:image" content="https://github.com/yfchenkeepgoing/image/blob/main/Snipaste_2024-02-28_23-51-30.png?raw=true">
<meta property="og:image" content="https://github.com/yfchenkeepgoing/image/blob/main/Snipaste_2024-02-29_02-48-28.png?raw=true">
<meta property="og:image" content="https://github.com/yfchenkeepgoing/image/blob/main/Snipaste_2024-03-05_06-42-52.png?raw=true">
<meta property="article:published_time" content="2024-02-22T21:27:22.000Z">
<meta property="article:modified_time" content="2024-03-08T04:58:15.225Z">
<meta property="article:author" content="Yifan Chen">
<meta property="article:tag" content="Frontend">
<meta property="article:tag" content="React">
<meta property="article:tag" content="Tailwind CSS">
<meta property="article:tag" content="Next.JS">
<meta property="article:tag" content="Prisma">
<meta property="article:tag" content="MongoDB">
<meta property="article:tag" content="NextAuth">
<meta property="article:tag" content="Vercel">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/yfchenkeepgoing/image/blob/main/Snipaste_2024-02-25_04-32-09.png?raw=true">

<link rel="canonical" href="http://example.com/2024/02/22/Full-Stack-Netflix-Clone/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Full Stack Netflix Clone | YifanChen's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="YifanChen's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">YifanChen's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">一个专注技术的新手程序员</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/yfchenkeepgoing/yfchenkeepgoing.github.io" class="github-corner" title="YifanChen GitHub" aria-label="YifanChen GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/02/22/Full-Stack-Netflix-Clone/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Yifan Chen">
      <meta itemprop="description" content="主要记录算法和web开发方面的心得体会">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YifanChen's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Full Stack Netflix Clone
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-02-22 21:27:22" itemprop="dateCreated datePublished" datetime="2024-02-22T21:27:22+00:00">2024-02-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-03-08 04:58:15" itemprop="dateModified" datetime="2024-03-08T04:58:15+00:00">2024-03-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">web开发</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Netflix-Clone"><a href="#Netflix-Clone" class="headerlink" title="Netflix Clone"></a>Netflix Clone</h1><h2 id="tech-stack"><a href="#tech-stack" class="headerlink" title="tech stack"></a>tech stack</h2><ul>
<li>Frontend: React</li>
<li>Server-side Rendering: Next.js</li>
<li>Styling: Tailwind CSS</li>
<li>Data abstraction layer: Prisma</li>
<li>Storage: MongoDB</li>
<li>Authentication: NextAuth</li>
<li>Deploy: Vercel</li>
<li>Typescript</li>
<li>the entire website fully</li>
</ul>
<p>The entire website fully responsive across all devices.</p>
<h2 id="function-overview"><a href="#function-overview" class="headerlink" title="function overview"></a>function overview</h2><p>credential login: username + password<br>profile: automatically generated once we register<br>homepage: loaded with a random movie-billboard<br>movies: load from database<br>favourites: add movies as favourites<br>botton:  shows more information about the movie<br>play the movie<br>Google oauth login</p>
<p>How to initialize next.js and Tailwind which is going to be crucial for our styling.</p>
<h2 id="Environment-setup"><a href="#Environment-setup" class="headerlink" title="Environment setup"></a>Environment setup</h2><h3 id="create-project"><a href="#create-project" class="headerlink" title="create project"></a>create project</h3><p>terminal:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx create-next-app --typescript</span><br></pre></td></tr></table></figure></p>
<p>set everything as default</p>
<p>open folder netflix-clone, enter command:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure></p>
<p>The website is running on: <a target="_blank" rel="noopener" href="http://localhost:1689/">http://localhost:1689/</a></p>
<p>clean up the project:<br>remove pages/_document.tsx<br>remove everything in pages/index.tsx except the main function:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Netflix Clone<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>remove all the content in styles/globals.css. Get a white page with Netflix Clone.</p>
<p>add <code>test.tsx</code> in pages folder. Add the below content in <code>test.tsx</code><br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">MyPage</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello New Page<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MyPage</span>;</span><br></pre></td></tr></table></figure></p>
<p>I can visit Hello New Page in <a target="_blank" rel="noopener" href="http://localhost:1689/test">http://localhost:1689/test</a>.<br>Delete <code>test.tsx</code>, it is just a demonstration of how easy it is to use Next.js.</p>
<h3 id="setup-tailwind"><a href="#setup-tailwind" class="headerlink" title="setup tailwind"></a>setup tailwind</h3><p>tailwind tutorial: <a target="_blank" rel="noopener" href="https://tailwindcss.com/docs/guides/nextjs">https://tailwindcss.com/docs/guides/nextjs</a></p>
<p>run the following commands in terminal:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install -D tailwindcss postcss autoprefixer</span><br><span class="line">npx tailwindcss init -p</span><br></pre></td></tr></table></figure></p>
<p>Now we have <code>tailwind.config.js</code> and <code>postcss.config.js</code>. Open <code>tailwind.config.js</code> and write the below code (according to tailwind tutorial above):<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">import(&#x27;tailwindcss&#x27;).Config</span>&#125; */</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">content</span>: [</span><br><span class="line">    <span class="string">&quot;./app/**/*.&#123;js,ts,jsx,tsx&#125;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;./pages/**/*.&#123;js,ts,jsx,tsx&#125;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;./components/**/*.&#123;js,ts,jsx,tsx&#125;&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">theme</span>: &#123;</span><br><span class="line">    <span class="attr">extend</span>: &#123;&#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Write code in <code>styles/globals.css</code> to import tailwind styles:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@tailwind</span> base;</span><br><span class="line"><span class="keyword">@tailwind</span> components;</span><br><span class="line"><span class="keyword">@tailwind</span> utilities;</span><br></pre></td></tr></table></figure></p>
<p>enter the command <code>npm run dev</code> again and we can see a different web page, because the content in <code>globals.css</code> reset the css.</p>
<p>Try to change the color of netflix clone to green in the web page, just write the following code in <code>index.tsx</code>:<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&quot;text-2xl text-green-500&quot;</span>&gt;</span>Netflix Clone<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Auth-Screen-UI"><a href="#Auth-Screen-UI" class="headerlink" title="Auth Screen UI"></a>Auth Screen UI</h2><p>In styles/globals.css, write:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@tailwind</span> base;</span><br><span class="line"><span class="keyword">@tailwind</span> components;</span><br><span class="line"><span class="keyword">@tailwind</span> utilities;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="keyword">@apply</span> bg-zinc-<span class="number">900</span> h-full overflow-x-hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>the web page turned to black. Add some code in globals.css:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#__next</span> &#123;</span><br><span class="line">    <span class="keyword">@apply</span> h-full;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">    <span class="keyword">@apply</span> h-full;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>create <code>images</code> folder in <code>public</code> folder and download <code>hero.jpg</code> and <code>logo.png</code> from github repository.  </p>
<p>Create <code>auth.tsx</code> in pages. It is the auth page. Write the following code in it:<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Auth</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="comment">// first div: add background pictures in auth page</span></span><br><span class="line">        <span class="comment">// second dic: make the picture a bit darker in the large screen</span></span><br><span class="line">        <span class="comment">// img: set logo (NETFLIX) className=&quot;h-12&quot; makes it smaller</span></span><br><span class="line">        <span class="comment">// third div: container</span></span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;relative h-full w-full bg-[url(&#x27;/images/hero.jpg&#x27;)] bg-no-repeat bg-center bg-fixed bg-cover&quot;</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;bg-black w-full h-full lg: bg-opacity-50&quot;</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">nav</span> <span class="attr">className</span>=<span class="string">&quot;px-12 py-5&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span> = <span class="string">&quot;/images/logo.png&quot;</span> <span class="attr">alt</span> = <span class="string">&quot;Logo&quot;</span> <span class="attr">className</span>=<span class="string">&quot;h-12&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;flex justify-center&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;bg-black bg-opacity-70 px-16 py-16 self-center mt-2 lg: w-2/5 lg: max-w-md rounded-md w-full&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">className</span>=<span class="string">&quot;text-white text-4xl mb-8 font-semibold&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            Sign in</span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;flex flex-col gap-4&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            </span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Auth</span>;</span><br></pre></td></tr></table></figure></p>
<p>create components folder and create <code>Input.tsx</code>. Write some codes in it:<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Input</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> /&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Input</span>;</span><br></pre></td></tr></table></figure></p>
<p>Now add the Input in <code>auth.tsx</code> :<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Input</span> <span class="keyword">from</span> <span class="string">&quot;@/components/Input&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;flex flex-col gap-4&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Input</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>Now add some floating labels in <code>Input.tsx</code>:<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Input</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;relative&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    block</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    rounded-md</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    px-6</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    pt-6</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    pb-1</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    w-full</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    text-md</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    text-white</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    bg-neutral-700</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    appearance-none</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    focus: outline-none</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    focus: ring-0</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    peer</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">placeholder</span>=<span class="string">&quot; &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Input</span>;</span><br></pre></td></tr></table></figure></p>
<p>现在我们想在sign in之下的第一个输入框加上Email字样，当点击输入框时，Email变小，不点击输入框时，Email变大，这是一种浮动的特效。<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// duration-150: duration for animation</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Input</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;relative&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">id</span> = <span class="string">&quot;email&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    block</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    rounded-md</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    px-6</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    pt-6</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    pb-1</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    w-full</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    text-md</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    text-white</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    bg-neutral-700</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    appearance-none</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    focus: outline-none</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    focus: ring-0</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    peer</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">placeholder</span>=<span class="string">&quot; &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">label</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                absolute</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                text-md</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                text-zinc-400</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                duration-150 </span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                transform</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                -translate-y-3</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                scale-75</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                top-4</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                z-10</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                origin-[0]</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                left-6</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                peer-placeholder-shown:scale-100</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                peer-placeholder-shown:translate-y-0</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                peer-focus:scale-75</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                peer-focus:-translate-y-3   </span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">htmlFor</span>=<span class="string">&quot;email&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                Email</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Input</span>;</span><br></pre></td></tr></table></figure></p>
<p>接下来让输入框模块化。加入react的一些特性：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">InputProps</span> &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">onChange</span>: <span class="built_in">any</span>;</span><br><span class="line">    <span class="attr">value</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">label</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">type</span>?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// duration-150: duration for animation</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Input</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">InputProps</span>&gt; = <span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    id,</span></span></span><br><span class="line"><span class="params"><span class="function">    onChange,</span></span></span><br><span class="line"><span class="params"><span class="function">    value,</span></span></span><br><span class="line"><span class="params"><span class="function">    label,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">type</span></span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;relative&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">onChange</span>=<span class="string">&#123;onChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">type</span>=<span class="string">&#123;type&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">value</span>=<span class="string">&#123;value&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">id</span>=<span class="string">&#123;id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    block</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    rounded-md</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    px-6</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    pt-6</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    pb-1</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    w-full</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    text-md</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    text-white</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    bg-neutral-700</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    appearance-none</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    focus: outline-none</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    focus: ring-0</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    peer</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">placeholder</span>=<span class="string">&quot; &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">label</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                absolute</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                text-md</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                text-zinc-400</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                duration-150 </span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                transform</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                -translate-y-3</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                scale-75</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                top-4</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                z-10</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                origin-[0]</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                left-6</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                peer-placeholder-shown:scale-100</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                peer-placeholder-shown:translate-y-0</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                peer-focus:scale-75</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                peer-focus:-translate-y-3   </span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">htmlFor</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;label&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Input</span>;</span><br></pre></td></tr></table></figure></p>
<p>此时发现auth.tsx报错，在input处加入以下代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Input</span></span><br><span class="line">    label=<span class="string">&quot;Email&quot;</span></span><br><span class="line">    onChange=&#123;<span class="function">() =&gt;</span> &#123;&#125;&#125;</span><br><span class="line">    id=<span class="string">&quot;email&quot;</span></span><br><span class="line">    <span class="keyword">type</span>=<span class="string">&quot;email&quot;</span></span><br><span class="line">    value=<span class="string">&quot;&quot;</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure></p>
<p>我们发现网页上的输入框无法输入内容，在<code>auth.tsx</code>中加入以下代码来解决这个问题：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Input</span> <span class="keyword">from</span> <span class="string">&quot;@/components/Input&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Auth</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> [email, setEmail] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    label=<span class="string">&quot;Email&quot;</span></span><br><span class="line">    onChange=&#123;<span class="function">(<span class="params">ev</span>) =&gt;</span> <span class="title function_">setEmail</span>(ev.<span class="property">target</span>.<span class="property">value</span>)&#125;</span><br><span class="line">    id=<span class="string">&quot;email&quot;</span></span><br><span class="line">    <span class="keyword">type</span>=<span class="string">&quot;email&quot;</span></span><br><span class="line">    value=&#123;email&#125;</span><br></pre></td></tr></table></figure></p>
<p>现在就可以在网页端的输入框内打字了。然后将上述内容复制两次，制造出username和password的输入框。<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [name, setName] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> [password, setPassword] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">label</span>=<span class="string">&quot;Username&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">onChange</span>=<span class="string">&#123;(ev:</span> <span class="attr">any</span>) =&gt;</span> setName(ev.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">    id=&quot;name&quot;</span></span><br><span class="line"><span class="language-xml">    value=&#123;name&#125;</span></span><br><span class="line"><span class="language-xml">/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">label</span>=<span class="string">&quot;Password&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">onChange</span>=<span class="string">&#123;(ev:</span> <span class="attr">any</span>) =&gt;</span> setPassword(ev.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">    id=&quot;password&quot;</span></span><br><span class="line"><span class="language-xml">    type=&quot;password&quot;</span></span><br><span class="line"><span class="language-xml">    value=&#123;password&#125;</span></span><br><span class="line"><span class="language-xml">/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>接下来写按钮login botton：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;button className=<span class="string">&quot;bg-red-600 py-3 text-white rounded-md w-full mt-10 hover:bg-red-700 transition&quot;</span>&gt;</span><br><span class="line">    <span class="title class_">Login</span></span><br><span class="line">&lt;/button&gt;</span><br></pre></td></tr></table></figure></p>
<p>产生了一个红色的按钮，点击按钮颜色会变深。</p>
<p>接着<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;p className=<span class="string">&quot;text-neutral-500 mt-12&quot;</span>&gt;</span><br><span class="line">    <span class="title class_">First</span> time using <span class="title class_">Netflix</span>?</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;text-white ml-1 hover:underline cursor-pointer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Create account</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure></p>
<p>接着在login和register之间产生一个跳转。<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [variant, setVariant] = <span class="title function_">useState</span>(<span class="string">&#x27;login&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> toggleVariant = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setVariant</span>(<span class="function">(<span class="params">currentVarient</span>) =&gt;</span> currentVarient === <span class="string">&#x27;login&#x27;</span> ? <span class="string">&#x27;register&#x27;</span>: <span class="string">&#x27;login&#x27;</span>)</span><br><span class="line">&#125;, [])</span><br><span class="line"></span><br><span class="line">&lt;span onClick=&#123;toggleVariant&#125; className=<span class="string">&quot;text-white ml-1 hover:underline cursor-pointer&quot;</span>&gt;</span><br><span class="line">    <span class="title class_">Create</span> account</span><br><span class="line">&lt;/span&gt;</span><br></pre></td></tr></table></figure></p>
<p>接着再将原本的login改为<code>&#123;variant === &#39;login&#39; ? &#39;Sign in&#39;: &#39;Register&#39;&#125;</code>。这样点击create account就会在sign in和register之间切换。由于在sign in时不需要看到username，而在register时要输入username，因此将username包裹在register中：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;variant === <span class="string">&#x27;register&#x27;</span> &amp;&amp; (</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">label</span>=<span class="string">&quot;Username&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">onChange</span>=<span class="string">&#123;(ev:</span> <span class="attr">any</span>) =&gt;</span> setName(ev.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">    id=&quot;name&quot;</span></span><br><span class="line"><span class="language-xml">    value=&#123;name&#125;</span></span><br><span class="line"><span class="language-xml">/&gt;</span></span><br><span class="line">)&#125;</span><br></pre></td></tr></table></figure></p>
<p>接着让按钮在sign in时显示为login，在register时显示为sign up。<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;button className=<span class="string">&quot;bg-red-600 py-3 text-white rounded-md w-full mt-10 hover:bg-red-700 transition&quot;</span>&gt;</span><br><span class="line">    &#123;variant === <span class="string">&#x27;login&#x27;</span> ? <span class="string">&#x27;Login&#x27;</span>: <span class="string">&#x27;Sign up&#x27;</span>&#125;</span><br><span class="line">&lt;/button&gt;</span><br></pre></td></tr></table></figure></p>
<p>接着让login界面中显示提示语：First time using Netflix. Create account。在register页面中显示提出语：Already have an account?Login.<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;p className=<span class="string">&quot;text-neutral-500 mt-12&quot;</span>&gt;</span><br><span class="line">    &#123;variant === <span class="string">&#x27;login&#x27;</span> ? <span class="string">&#x27;First time using Netflix?&#x27;</span> : <span class="string">&#x27;Already have an account?&#x27;</span>&#125;</span><br><span class="line">    &lt;span onClick=&#123;toggleVariant&#125; className=<span class="string">&quot;text-white ml-1 hover:underline cursor-pointer&quot;</span>&gt;</span><br><span class="line">        &#123;variant === <span class="string">&#x27;login&#x27;</span> ? <span class="string">&#x27;Create account&#x27;</span> : <span class="string">&#x27;Login&#x27;</span>&#125;</span><br><span class="line">    &lt;/span&gt;</span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="NextAuth-Prisma-Mongo-Setup"><a href="#NextAuth-Prisma-Mongo-Setup" class="headerlink" title="NextAuth, Prisma, Mongo Setup"></a>NextAuth, Prisma, Mongo Setup</h2><p>将上述登录注册的UI界面通过prisma连接到mongodb。先在vscode中安装扩展prisma，其可以帮助对prisma文件进行格式化和高亮。接着在终端输入命令：<code>npm install -D prisma</code></p>
<p>再输入命令：<code>npx prisma init</code>，本命令可以产生一个<code>schema.prisma</code>文件。将其中的数据库修改为mongodb:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">generator client &#123;</span><br><span class="line">  provider = &quot;prisma-client-js&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">datasource db &#123;</span><br><span class="line">  provider = &quot;mongodb&quot;</span><br><span class="line">  url      = env(&quot;DATABASE_URL&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接着在终端输入：<code>npm install @prisma/client</code>。接着再创建新的文件夹lib。在其中创建<code>prismadb.ts</code>文件，写入以下代码：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PrismaClient</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@prisma/client&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client = <span class="variable language_">global</span>.<span class="property">prismadb</span> || <span class="keyword">new</span> <span class="title class_">PrismaClient</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span>) <span class="variable language_">global</span>.<span class="property">prismadb</span> = client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> client;</span><br></pre></td></tr></table></figure></p>
<p>next.js具有特性：hot reloading。每次代码改变时，我们的项目自动更新并重新运行。对prisma而言，每次会产生若干个PrismaClient实例，就会得到报错：已经有若干个Prisma Client正在运行。我们将PrismaClient存储在一个全局文件中，而全局文件并不会被hot reloading影响，因此就不会产生上面的报错。接着来解决prismadb标红的错误。</p>
<p>根目录下创建文件<code>global.d.ts</code>，在其中定义prismadb，写入以下内容：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PrismaClient</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@prisma/client&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">global</span> &#123;</span><br><span class="line">    <span class="keyword">namespace</span> globalThis &#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="attr">prismadb</span>: <span class="title class_">PrismaClient</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接着进入<code>schema.prisma</code>文件，填入DATABASE_URL。需要先进入.env文件，将其中的database url换成有效的url。在谷歌中搜索mongodb atlas，注册并登录。点击build a database。我的database的username是cyf，密码是20001017。IP地址点击add my current IP address即可。接着在overview页面点击connect，选择mongodb for vscode。复制它给出的URL并粘贴到.env文件中。需要将URL中的<code>&lt;password&gt;</code>替换为自己真实的密码。并在URL的末尾加上我的实际数据库的名字：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DATABASE_URL=&quot;mongodb+srv://cyf:20001017@cluster0.38xordg.mongodb.net/Cluster0&quot;</span><br></pre></td></tr></table></figure></p>
<p>接着，在<code>schema.prisma</code>文件中一次性定义好所有的models（数据模型）。因为反复修改数据模型和运行项目可能会导致一些麻烦和报错。<code>schema.prisma</code>文件内容如下所示：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">// This is your Prisma schema file,</span><br><span class="line">// learn more about it in the docs: https://pris.ly/d/prisma-schema</span><br><span class="line"></span><br><span class="line">// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?</span><br><span class="line">// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init</span><br><span class="line"></span><br><span class="line">generator client &#123;</span><br><span class="line">  provider = &quot;prisma-client-js&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">datasource db &#123;</span><br><span class="line">  provider = &quot;mongodb&quot;</span><br><span class="line">  url      = env(&quot;DATABASE_URL&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">model User &#123;</span><br><span class="line">  id String @id @default(auto()) @map(&quot;_id&quot;) @db.ObjectId // 每个model都需要这一行，因为mongodb的model一定需要定义id</span><br><span class="line">  name String</span><br><span class="line">  image String? // ?表示可选，可要可不要</span><br><span class="line">  email String? @unique // 非必须，可能用到oauth login</span><br><span class="line">  emailVerified DateTime?</span><br><span class="line">  hashedPassword String? // 密码登录所需要</span><br><span class="line">  createAt DateTime @default(now())</span><br><span class="line">  updateAt DateTime @updatedAt // 自动更新 更新时间</span><br><span class="line">  favoriteIds String[] @db.ObjectId // 用户最喜欢的电影</span><br><span class="line">  sessions Session[]</span><br><span class="line">  accounts Account[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 用于Google Account或者GitHub Account</span><br><span class="line">model Account &#123;</span><br><span class="line">  id String @id @default(auto()) @map(&quot;_id&quot;) @db.ObjectId</span><br><span class="line">  userId String @db.ObjectId // account和userid之间的关系</span><br><span class="line">  type String</span><br><span class="line">  provider String</span><br><span class="line">  providerAccountId String</span><br><span class="line">  refresh_token String? @db.String</span><br><span class="line">  access_token String? @db.String</span><br><span class="line">  expires_at Int?</span><br><span class="line">  token_type String?</span><br><span class="line">  scope String?</span><br><span class="line">  id_token String? @db.String</span><br><span class="line">  session_state String?</span><br><span class="line"></span><br><span class="line">  // 将account model和user model之间通过userId连接, onDelate表示二者的删除是同步的(user被删除了，account也被删除)</span><br><span class="line">  user User @relation(fields: [userId], references: [id], onDelete: Cascade)</span><br><span class="line"></span><br><span class="line">  @@unique([provider, providerAccountId]) // 独一无二，不允许重复</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">model Session &#123;</span><br><span class="line">  id String @id @default(auto()) @map(&quot;_id&quot;) @db.ObjectId</span><br><span class="line">  sessionToken String @unique</span><br><span class="line">  userId String @db.ObjectId</span><br><span class="line">  expires DateTime</span><br><span class="line"></span><br><span class="line">  user User @relation(fields: [userId], references: [id], onDelete: Cascade)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">model VerificationToken &#123;</span><br><span class="line">  id String @id @default(auto()) @map(&quot;_id&quot;) @db.ObjectId</span><br><span class="line">  identifier String</span><br><span class="line">  token String @unique</span><br><span class="line">  expires DateTime</span><br><span class="line"></span><br><span class="line">  @@unique([identifier, token])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">model Movie &#123;</span><br><span class="line">  id String @id @default(auto()) @map(&quot;_id&quot;) @db.ObjectId</span><br><span class="line">  title String</span><br><span class="line">  description String</span><br><span class="line">  videoUrl String</span><br><span class="line">  thumbnailUrl String // 缩略网址</span><br><span class="line">  genre String // 类型</span><br><span class="line">  duration String</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接着在终端运行命令：<code>npx prisma db push</code>，将<code>schema.prisma</code>文件中定义的数据模型上传到云端，在mongodb的网页端选择database-browse collections，即可看到定义的5个数据模型。这说明prisma已经成功和mongodb连接起来了。</p>
<p>接着进入pages/api/hello.ts，可以通过链接：<a target="_blank" rel="noopener" href="http://localhost:1689/api/hello访问到其中的内容。删除hello.ts，新建`[...nextauth].ts`文件，其会被next">http://localhost:1689/api/hello访问到其中的内容。删除hello.ts，新建`[...nextauth].ts`文件，其会被next</a> app识别。我们在这个文件中写next auth的middleware。通过命令<code>npm install next-auth</code>安装next-auth。还需要运行命令：<code>npm install bcrypt</code>。这个包用于用户名密码登录。在<code>[...nextauth].ts</code>文件中写下以下的内容：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">NextAuth</span> <span class="keyword">from</span> <span class="string">&#x27;next-auth&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Credentials</span> <span class="keyword">from</span> <span class="string">&#x27;next-auth/providers/credentials&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; compare &#125; <span class="keyword">from</span> <span class="string">&#x27;bcrypt&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> prismadb <span class="keyword">from</span> <span class="string">&#x27;@/lib/prismadb&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">NextAuth</span>(&#123;</span><br><span class="line">    <span class="attr">providers</span>: [</span><br><span class="line">        <span class="title class_">Credentials</span>(&#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="string">&#x27;credentials&#x27;</span>,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;Credentials&#x27;</span>,</span><br><span class="line">            <span class="attr">credentials</span>: &#123;</span><br><span class="line">                <span class="attr">email</span>: &#123;</span><br><span class="line">                    <span class="attr">label</span>: <span class="string">&#x27;Email&#x27;</span>,</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">password</span>: &#123;</span><br><span class="line">                    <span class="attr">label</span>: <span class="string">&#x27;Password&#x27;</span>,</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;password&#x27;</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">async</span> <span class="title function_">authorize</span>(<span class="params">credentials</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!credentials?.<span class="property">email</span> || !credentials?.<span class="property">password</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Email and password required&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 通过email找到用户，需要import prismadb</span></span><br><span class="line">                <span class="keyword">const</span> user = <span class="keyword">await</span> prismadb.<span class="property">user</span>.<span class="title function_">findUnique</span>(&#123;</span><br><span class="line">                    <span class="attr">where</span>: &#123;</span><br><span class="line">                        <span class="attr">email</span>: credentials.<span class="property">email</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 判断找到的user是否存在</span></span><br><span class="line">                <span class="keyword">if</span> (!user || !user.<span class="property">hashedPassword</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Email does not exist&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 判断用户输入的密码是否正确</span></span><br><span class="line">                <span class="keyword">const</span> isCorrectPassword = <span class="keyword">await</span> <span class="title function_">compare</span>(</span><br><span class="line">                    credentials.<span class="property">password</span>, </span><br><span class="line">                    user.<span class="property">hashedPassword</span></span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!isCorrectPassword) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Incorrect password&quot;</span>); </span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> user; <span class="comment">// 用户密码输入正确，则返回由email找到的唯一user</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="attr">pages</span>: &#123;</span><br><span class="line">        <span class="attr">signIn</span>: <span class="string">&#x27;/auth&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// debug on</span></span><br><span class="line">    <span class="attr">debug</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">session</span>: &#123;</span><br><span class="line">        <span class="attr">strategy</span>: <span class="string">&#x27;jwt&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>在<code>.env</code>文件中加入以下两个环境变量：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NEXTAUTH_JWT_SECRET = &quot;NEXT-JWT-SECRET&quot;</span><br><span class="line">NEXTAUTH_SECRET = &quot;NEXT-SECRET&quot;</span><br></pre></td></tr></table></figure></p>
<p>在<code>[...nextauth].ts</code>文件中添加以下的内容：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    <span class="attr">jwt</span>: &#123;</span><br><span class="line">        <span class="attr">secret</span>: process.<span class="property">env</span>.<span class="property">NEXTAUTH_JWT_SECRET</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">secret</span>: process.<span class="property">env</span>.<span class="property">NEXTAUTH_SECRET</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>接下来修复<code>bcrypt</code>标红的报错。在终端输入命令：<code>npm i -D @types/bcrypt</code>。安装了<code>bcrypt</code>后，不再标红报错。</p>
<p>进入<code>pages/auth.tsx</code>。在其中添加login和register的函数。首先通过命令行安装<code>axios</code>: <code>npm i axios</code>。然后在<code>auth.tsx</code>中引入<code>axios</code>并定义register函数：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// register function</span></span><br><span class="line"><span class="keyword">const</span> register = <span class="title function_">useCallback</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;, []); <span class="comment">// dependency: []</span></span><br></pre></td></tr></table></figure></p>
<p>接着写下完整的register函数：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// register function</span></span><br><span class="line"><span class="keyword">const</span> register = <span class="title function_">useCallback</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="string">&#x27;/api/register&#x27;</span>, &#123;</span><br><span class="line">            email,</span><br><span class="line">            name,</span><br><span class="line">            password</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, []); <span class="comment">// dependency: []</span></span><br></pre></td></tr></table></figure></p>
<p>接着在<code>pages/api</code>中定义<code>register</code>。在<code>register.ts</code>中写下了如下的代码：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bcrypt <span class="keyword">from</span> <span class="string">&#x27;bcrypt&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NextApiRequest</span>, <span class="title class_">NextApiResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;next&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> prismadb <span class="keyword">from</span> <span class="string">&#x27;@/lib/prismadb&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params">req: NextApiRequest, res: NextApiResponse</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> !== <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">405</span>).<span class="title function_">end</span>(); <span class="comment">// we only want to allow post calls to /api/register</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// try and catch block</span></span><br><span class="line">    <span class="comment">// try: extract some values from request.body</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; email, name, password &#125; = req.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// check if an email is already in use</span></span><br><span class="line">        <span class="keyword">const</span> existinguser = <span class="keyword">await</span> prismadb.<span class="property">user</span>.<span class="title function_">findUnique</span>(&#123;</span><br><span class="line">            <span class="attr">where</span>: &#123;</span><br><span class="line">                email,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// email in use, return Email taken</span></span><br><span class="line">        <span class="keyword">if</span> (existinguser) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">422</span>).<span class="title function_">json</span>(&#123;<span class="attr">error</span>: <span class="string">&#x27;Email taken&#x27;</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// hash the password</span></span><br><span class="line">        <span class="keyword">const</span> hashedPassword = <span class="keyword">await</span> bcrypt.<span class="title function_">hash</span>(password, <span class="number">12</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将user信息存入数据库</span></span><br><span class="line">        <span class="keyword">const</span> user = <span class="keyword">await</span> prismadb.<span class="property">user</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">            <span class="attr">data</span>: &#123;</span><br><span class="line">                email,</span><br><span class="line">                name,</span><br><span class="line">                hashedPassword,</span><br><span class="line">                <span class="attr">image</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                <span class="attr">emailVerified</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(),</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(user);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这就完成了<code>/api/register</code>。在<code>auth.tsx</code>中填入dependency的具体内容：<code>[email, name, password]); // dependency in []</code>。</p>
<p>接着，我们需要在点击sign up按钮时呼叫<code>/api/register</code>。先不管按钮上写的是login还是register，将按钮统一绑定到register函数：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;register&#125; className=<span class="string">&quot;bg-red-600 py-3 text-white rounded-md w-full mt-10 hover:bg-red-700 transition&quot;</span>&gt;</span><br><span class="line">    &#123;variant === <span class="string">&#x27;login&#x27;</span> ? <span class="string">&#x27;Login&#x27;</span>: <span class="string">&#x27;Sign up&#x27;</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>打开网页，F12打开调试模式，选择network，输入用户名、邮箱和密码，可以看到register函数被成功调用。接着打开mongodb atlas的网站，选择database-browse collections-user，可以看到其中添加了一条用户信息的数据，成功！到此，用户名密码注册部分完成了。</p>
<p>现在开始做Login部分。在<code>auth.tsx</code>中添加以下login函数：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// login function</span></span><br><span class="line"><span class="keyword">const</span> login = <span class="title function_">useCallback</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// try and catch block</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 需要用到[..nextauth].ts中的Credentials</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">signIn</span>(<span class="string">&#x27;credentials&#x27;</span>, &#123;</span><br><span class="line">            email,</span><br><span class="line">            password,</span><br><span class="line">            <span class="attr">redirect</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">callbackUrl</span>: <span class="string">&#x27;/&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, [email, password]); <span class="comment">// login only need email and password</span></span><br></pre></td></tr></table></figure></p>
<p>接着在按钮处调用login函数：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;variant === <span class="string">&#x27;login&#x27;</span> ? login : register&#125; className=<span class="string">&quot;bg-red-600 py-3 text-white rounded-md w-full mt-10 hover:bg-red-700 transition&quot;</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>这样就可以在点击login按钮时调用login函数，在点击sign up按钮时调用register函数。点击login按钮，网页并没有产生预期的跳转，打印出错误信息：Error: This action with HTTP GET is not supported by NextAuth.js。尝试修复这个问题。在api文件夹中再创建auth文件夹，将<code>[...nextauth].ts</code>文件拖拽到其中。然后这个问题就被修复了。接着继续在login函数中添加router：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">useRouter</span>(); </span><br><span class="line"></span><br><span class="line"><span class="comment">// login function</span></span><br><span class="line"><span class="keyword">const</span> login = <span class="title function_">useCallback</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// try and catch block</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 需要用到[..nextauth].ts中的Credentials</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">signIn</span>(<span class="string">&#x27;credentials&#x27;</span>, &#123;</span><br><span class="line">            email,</span><br><span class="line">            password,</span><br><span class="line">            <span class="attr">redirect</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">callbackUrl</span>: <span class="string">&#x27;/&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        router.<span class="title function_">push</span>(<span class="string">&#x27;/&#x27;</span>); </span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, [email, password, router]); <span class="comment">// login only need email and password, and then we add router</span></span><br></pre></td></tr></table></figure></p>
<p>接着在register函数中添加login部分，一旦注册成功后就自动登录。<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// register function</span></span><br><span class="line"><span class="keyword">const</span> register = <span class="title function_">useCallback</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="string">&#x27;/api/register&#x27;</span>, &#123;</span><br><span class="line">            email,</span><br><span class="line">            name,</span><br><span class="line">            password</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="title function_">login</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, [email, name, password, login]); <span class="comment">// dependency in []</span></span><br></pre></td></tr></table></figure></p>
<p>同时注意调整login和register函数的顺序，让login定义在register之前（因为register中需要调用login函数）。现在再次尝试输入邮箱和密码并点击login按钮，发现可以成功跳转到根目录。</p>
<h2 id="Google-and-Github-OAuth"><a href="#Google-and-Github-OAuth" class="headerlink" title="Google and Github OAuth"></a>Google and Github OAuth</h2><p>加入Google and Github OAuth非常简单。首先在终端中运行命令：<code>npm install react-icons</code>。通过这个包可以向项目中添加Google, Github和其他炫酷的icon。接下来写google和github一键登录的UI界面。在<code>auth.tsx</code>中加入以下代码。首先是引入react中包含icons的包，然后在login/sign up按钮下定义一个div，用于空出更大的空间。再定义一个div，用于存放按钮。在这个div中定义按钮的各种属性（居中、圆角等）。最后再通过<code>FcGoogle</code>引入Google的图标。接着，我们复制上面的代码，将图标改为Github。以上的代码如下所示：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FcGoogle</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-icons/fc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FaGithub</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-icons/fa&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;flex flex-row items-center gap-4 mt-8 justify-center&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            w-10</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            h-10</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            bg-white</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            rounded-full</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            flex</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            items-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            justify-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            cursor-pointer</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            hover:opacity-80</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            transition</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">FcGoogle</span> <span class="attr">size</span>=<span class="string">&#123;30&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            w-10</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            h-10</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            bg-white</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            rounded-full</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            flex</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            items-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            justify-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            cursor-pointer</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            hover:opacity-80</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            transition</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">FaGithub</span> <span class="attr">size</span>=<span class="string">&#123;30&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>接着进入<code>.env</code>文件中增加一些环境变量。如下所示：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GITHUB_ID=</span><br><span class="line">GITHUB_SECRET=</span><br><span class="line"></span><br><span class="line">GOOGLE_CLIENT_ID=</span><br><span class="line">GOOGLE_CLIENT_SECRET=</span><br></pre></td></tr></table></figure></p>
<p>接着在<code>[...nextauth].ts</code>文件中添加包和GithubProvider、GoogleProvider。<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">GithubProvider</span> <span class="keyword">from</span> <span class="string">&#x27;next-auth/providers/github&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">GoogleProvider</span> <span class="keyword">from</span> <span class="string">&#x27;next-auth/providers/google&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">GithubProvider</span>(&#123;</span><br><span class="line">    <span class="attr">clientId</span>: process.<span class="property">env</span>.<span class="property">GITHUB_ID</span> || <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">clientSecret</span>: process.<span class="property">env</span>.<span class="property">GITHUB_SECRET</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;),</span><br><span class="line"><span class="title class_">GoogleProvider</span>(&#123;</span><br><span class="line">    <span class="attr">clientId</span>: process.<span class="property">env</span>.<span class="property">GOOGLE_CLIENT_ID</span> || <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">clientSecret</span>: process.<span class="property">env</span>.<span class="property">GOOGLE_CLIENT_SECRET</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure></p>
<p>接着执行命令：<code>npm install @next-auth/prisma-adapter</code>。接着在<code>[...nextauth].ts</code>文件中添加以下代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PrismaAdapter</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@next-auth/prisma-adapter&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="attr">adapter</span>: <span class="title class_">PrismaAdapter</span>(prismadb),</span><br></pre></td></tr></table></figure></p>
<p>接下来填入.env文件中的GITHUB_ID和GITHUB_SECRET。去到GITHUB-SETTINGS-DEVELOPER SETTINGS-OAUTH APPS-NEW OAUTH APP，填入以下内容：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Register a new OAuth application</span><br><span class="line">Application name</span><br><span class="line">netflix-clone</span><br><span class="line"></span><br><span class="line">Homepage URL</span><br><span class="line">http://localhost:1689</span><br><span class="line"></span><br><span class="line">Authorization callback URL</span><br><span class="line">http://localhost:1689</span><br></pre></td></tr></table></figure></p>
<p>接着点击register application，然后将生成的GITHUB_ID和GITHUB_SECRET复制到<code>.env</code>文件中。</p>
<p>现在我们在<code>auth.tsx</code>中给github一键登录写一个函数:<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onClick=&#123;<span class="function">() =&gt;</span> <span class="title function_">signIn</span>(<span class="string">&#x27;github&#x27;</span>, &#123; <span class="attr">callbackUrl</span>: <span class="string">&#x27;/&#x27;</span> &#125;)&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>并在<code>.env</code>文件中指定重定向URL的路径：<code>NEXTAUTH_URL=http://localhost:10564/</code></strong><br>进行上述操作后，github一键登录成功，一键登录成功后被导航回到了根目录。然后可以在mongodb的account中看到一条新的数据。本来应该在user中也看到一条新的数据，但我的user中没有github一键登录产生的新user的数据。这个问题在github的issues中有解释：<a target="_blank" rel="noopener" href="https://github.com/AntonioErdeljac/next-netflix-tutorial/issues/13。这个问题应该不是一个问题，不用担心。">https://github.com/AntonioErdeljac/next-netflix-tutorial/issues/13。这个问题应该不是一个问题，不用担心。</a></p>
<p>现在开始完成google一键登录。相比于github，Google会更麻烦些。进入google cloud console: <a target="_blank" rel="noopener" href="https://console.cloud.google.com/welcome?pli=1&amp;project=advance-proton-400620。新建项目并填入项目名称，点创建。选中该项目，搜索apis">https://console.cloud.google.com/welcome?pli=1&amp;project=advance-proton-400620。新建项目并填入项目名称，点创建。选中该项目，搜索apis</a> &amp; services。选择oauth权限请求页面，选择外部，点击创建。填入应用名称、用户支持电子邮件、开发者联系信息，然后保存并继续。然后一路点击保存并继续。点击凭据-创建凭据-创建 OAuth 客户端 ID。选择web应用-添加URL：<a target="_blank" rel="noopener" href="http://localhost:10564/api/auth/callback/google。我们就可以得到client">http://localhost:10564/api/auth/callback/google。我们就可以得到client</a> ID和client secret。将它们复制到<code>.env</code>文件中。然后在<code>auth.tsx</code>中给google一键登录写一个函数:<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onClick=&#123;<span class="function">() =&gt;</span> <span class="title function_">signIn</span>(<span class="string">&#x27;google&#x27;</span>, &#123; <span class="attr">callbackUrl</span>: <span class="string">&#x27;/&#x27;</span> &#125;)&#125;</span><br></pre></td></tr></table></figure></p>
<p>在网页端尝试点击google一键登录，成功！</p>
<h2 id="Protecting-routes-Profiles-screen"><a href="#Protecting-routes-Profiles-screen" class="headerlink" title="Protecting routes, Profiles screen"></a>Protecting routes, Profiles screen</h2><p>如何通过授权登录保护client路径和api路径。在lib文件夹中创建<code>serverAuth.ts</code>。在其中写下如下的代码：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NextApiRequest</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;next&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getSession &#125; <span class="keyword">from</span> <span class="string">&#x27;next-auth/react&#x27;</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> prismadb <span class="keyword">from</span> <span class="string">&#x27;@/lib/prismadb&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; error &#125; <span class="keyword">from</span> <span class="string">&#x27;console&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">serverAuth</span> = <span class="keyword">async</span> (<span class="params">req: NextApiRequest</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// fetch log in user session</span></span><br><span class="line">    <span class="keyword">const</span> session = <span class="keyword">await</span> <span class="title function_">getSession</span>(&#123; req &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// use serverAuth in api controller</span></span><br><span class="line">    <span class="comment">// req parameter  will hold jwt token to get logged in user</span></span><br><span class="line">    <span class="comment">// use session to get other fields</span></span><br><span class="line">    <span class="keyword">if</span> (!session?.<span class="property">user</span>?.<span class="property">email</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Not signed in&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过email找到不同的user</span></span><br><span class="line">    <span class="keyword">const</span> currentUser = <span class="keyword">await</span> prismadb.<span class="property">user</span>.<span class="title function_">findUnique</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>: &#123;</span><br><span class="line">            <span class="attr">email</span>: session.<span class="property">user</span>.<span class="property">email</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 无currentUser, 说明jwt token或者session不正确或者过期了</span></span><br><span class="line">    <span class="keyword">if</span> (!currentUser) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Not signed in&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123; currentUser &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> serverAuth;</span><br></pre></td></tr></table></figure></p>
<p>用上述文件可以在所有的api routes中检查我们是否登录。进入<code>pages/api</code>中，创建<code>current.ts</code>，在其中写上以下的代码：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NextApiRequest</span>, <span class="title class_">NextApiResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;next&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> serverAuth <span class="keyword">from</span> <span class="string">&#x27;@/lib/serverAuth&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params">req: NextApiRequest, res: NextApiResponse</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> !== <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">405</span>).<span class="title function_">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// try and catch block</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; currentUser &#125; = <span class="keyword">await</span> <span class="title function_">serverAuth</span>(req); </span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(currentUser);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面开始写用于front end fetching的部分，在<code>libs/fetcher.ts</code>，在其中写下代码：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fetcher</span> = (<span class="params">url: <span class="built_in">string</span></span>) =&gt; axios.<span class="title function_">get</span>(url).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="property">data</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> fetcher;</span><br></pre></td></tr></table></figure></p>
<p>在前端写用于载入当前用户的代码。在根目录下新建hooks文件夹，在其中新建文件<code>useCurrentUser.ts</code>。然后在终端中运行命令：<code>npm install swr</code>。然后在<code>useCurrentUser.ts</code>中写入：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useSWR <span class="keyword">from</span> <span class="string">&#x27;swr&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> fetcher <span class="keyword">from</span> <span class="string">&#x27;@/lib/fetcher&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// svr: versal developed package, which is good at fetching data</span></span><br><span class="line"><span class="comment">// If the data already exists, we are not going to fetch the data again</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useCurrentUser</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data, error, isLoading, mutate &#125; = <span class="title function_">useSWR</span>(<span class="string">&#x27;/api/current&#x27;</span>, fetcher)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        data,</span><br><span class="line">        error,</span><br><span class="line">        isLoading,</span><br><span class="line">        mutate</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useCurrentUser;</span><br></pre></td></tr></table></figure></p>
<p>下面我们来展示如何保护client routes。我们想让用户在不登陆的情况下访问不到我们的网站。在<code>pages/index.tsx</code>中首先创建一个sign out按钮。<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button className=<span class="string">&quot;h-10 w-full bg-white&quot;</span> onClick=&#123;<span class="function">() =&gt;</span> <span class="title function_">signOut</span>()&#125;&gt;<span class="title class_">Logout</span>!&lt;/button&gt;</span><br></pre></td></tr></table></figure></p>
<p>接下来我们来演示如何在<code>pages/index.tsx</code>中保护家路径。在其中写下以下的代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NextPageContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;next&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getSession, signOut &#125; <span class="keyword">from</span> <span class="string">&quot;next-auth/react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fetch our session from client side</span></span><br><span class="line"><span class="comment">// cannot use serverAuth</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getServerSideProps</span>(<span class="params">context: NextPageContext</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> session = <span class="keyword">await</span> <span class="title function_">getSession</span>(context);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// session不存在，则返回登录界面</span></span><br><span class="line">  <span class="keyword">if</span> (!session) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">redirect</span>: &#123;</span><br><span class="line">        <span class="attr">destination</span>: <span class="string">&#x27;/auth&#x27;</span>,</span><br><span class="line">        <span class="attr">permanent</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// session存在，则返回空</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">props</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&quot;text-4xl text-green-500&quot;</span>&gt;</span>Netflix Clone<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;h-10 w-full bg-white&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> signOut()&#125;&gt;Logout!<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>现在实现了功能：用户不能在未登录的情况下直接访问家目录。现在的问题：登出以后无法登录并进入到家目录。进入mongodb-network access。点击add ip address，选择allow access from anywhere。目前项目仍然不能正常登录。报错信息显示：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[next-auth][error][CLIENT_FETCH_ERROR] </span><br><span class="line">https://next-auth.js.org/errors#client_fetch_error fetch failed &#123;</span><br><span class="line">  error: &#123;</span><br><span class="line">    message: &#x27;fetch failed&#x27;,</span><br><span class="line">    stack: &#x27;TypeError: fetch failed\n&#x27; +</span><br><span class="line">      &#x27;    at node:internal/deps/undici/undici:12443:11\n&#x27; +</span><br><span class="line">      &#x27;    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&#x27;,</span><br><span class="line">    name: &#x27;TypeError&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  url: &#x27;http://localhost:10564/api/auth/session&#x27;,</span><br><span class="line">  message: &#x27;fetch failed&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我尝试了若干种解决办法，最后是这样解决的：<br>由于在默认情况下，port和forwarded address是不同的，这样就会导致上面的报错，<strong>我猜测是产生了跨域问题，导致port和forwarded address之间的信息转发失败了</strong>。我们需要将port和forwarded address的端口号改成相同的，并在<code>.env</code>文件和<code>package.json</code>文件中做出相应的修改。以我在本项目中的实际操作为例。我将port改为10564，将forwarded address也改为10564（vscode-PORTS中会自动补全为<code>localhost:10564</code>），然后在<code>.env</code>文件中添加：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NEXTAUTH_URL=&quot;http://localhost:10564&quot;</span><br></pre></td></tr></table></figure>
<p>在<code>package.json</code>文件中添加：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;next dev -p 10564&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;next start -p 10564&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure></p>
<p>然后重启项目，就可以成功地通过用户名密码/github/google登入登出根页面了。</p>
<p>接下来关注如何通过<code>useCurrentUser.ts</code>中的hook来获取用户信息。在<code>index.tsx</code>中加入以下代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useCurrentUser <span class="keyword">from</span> <span class="string">&quot;@/hooks/useCurrentUser&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; data : user &#125; = <span class="title function_">useCurrentUser</span>();</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;text-white&quot;</span>&gt;</span>Logged in as : &#123;user?.email&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>这样在根页面就会显示Logged in as + 登录用户邮箱的信息。现在我们来创建用户档案页面。在pages文件夹下创建<code>profiles.tsx</code>文件，在其中加入以下框架：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Profiles</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;text-white text-4xl&quot;</span>&gt;</span>Profiles<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Profiles</span>;</span><br></pre></td></tr></table></figure></p>
<p>接着访问<a target="_blank" rel="noopener" href="http://localhost:10564/profiles，就可以看到白色的Profiles字样。接着在`profiles.tsx`文件中写`fetch">http://localhost:10564/profiles，就可以看到白色的Profiles字样。接着在`profiles.tsx`文件中写`fetch</a> session`的代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fetch our session from client side, just like  what we do in index.tsx</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getServerSideProps</span>(<span class="params">context: NextPageContext</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> session = <span class="keyword">await</span> <span class="title function_">getSession</span>(context); <span class="comment">// get session</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!session) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">redirect</span>: &#123;</span><br><span class="line">                <span class="attr">destination</span>: <span class="string">&#x27;/auth&#x27;</span>,</span><br><span class="line">                <span class="attr">permanent</span>: <span class="literal">false</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">props</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接着在<code>auth.tsx</code>中，将三个登录处的重定向URL重定向到profiles页面并删除<code>router</code>。现在产生了效果：在未登录时访问profiles页面会被重定向到auth页面。在auth页面登录后会被重定向到profiles页面。从github仓库中下载default blue图片，作为用户的默认头像。在<code>profiles.tsx</code>中写下了如下的代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Profiles</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: user &#125; = <span class="title function_">useCurrentUser</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;flex items-center h-full justify-center&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;flex flex-col&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&quot;text-3xl md:text-6xl text-white text-center&quot;</span> &gt;</span>Who is watching?<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;flex items-center justify-center gap-8 mt-10&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;&#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;group flex-row w-44 mx-auto&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                w-44</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                h-44</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                rounded-md</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                flex</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                items-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                justify-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                border-2</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                border-transparent</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                group-hover:cursor-pointer</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                group-hover:border-white</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                overflow-hidden</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            &gt;</span></span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/images/default-blue.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Profile&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                mt-4</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                text-gray-400</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                text-2xl</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                text-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                group-hover:text-white</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            &gt;</span></span></span><br><span class="line"><span class="language-xml">                                &#123;user?.name&#125;</span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>产生了如下的效果：<br><img src="https://github.com/yfchenkeepgoing/image/blob/main/Snipaste_2024-02-25_04-32-09.png?raw=true" alt="Snipaste_2024-02-25_04-32-09.png"></p>
<p>然后让点击图片会重定向回到根网页。增加以下代码即可：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">useRouter</span>()</span><br><span class="line"></span><br><span class="line">&lt;div onClick=&#123;<span class="function">() =&gt;</span> router.<span class="title function_">push</span>(<span class="string">&#x27;/&#x27;</span>)&#125;&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="Navagation-Component"><a href="#Navagation-Component" class="headerlink" title="Navagation Component"></a>Navagation Component</h2><p>清理<code>index.tsx</code>文件，只剩下骨架即可（不需要按钮和sign out功能）：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NextPageContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;next&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getSession &#125; <span class="keyword">from</span> <span class="string">&quot;next-auth/react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fetch our session from client side</span></span><br><span class="line"><span class="comment">// cannot use serverAuth</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getServerSideProps</span>(<span class="params">context: NextPageContext</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> session = <span class="keyword">await</span> <span class="title function_">getSession</span>(context);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// session不存在，则返回登录界面</span></span><br><span class="line">  <span class="keyword">if</span> (!session) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">redirect</span>: &#123;</span><br><span class="line">        <span class="attr">destination</span>: <span class="string">&#x27;/auth&#x27;</span>,</span><br><span class="line">        <span class="attr">permanent</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// session存在，则返回空</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">props</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们需要在上述文件中添加<code>Navbar</code>，但目前<code>Navbar</code>尚不存在，因此需要在<code>components</code>文件夹中添加<code>Navbar.tsx</code>。<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Navbar</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            Navbar</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Navbar</span>;</span><br></pre></td></tr></table></figure></p>
<p>然后在<code>index.tsx</code>中import并添加<code>Navbar</code>。接下来在<code>Navbar.tsx</code>中写入具体的内容。<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Navbar</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="comment">// navigation type</span></span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">className</span>=<span class="string">&quot;w-full fixed z-40&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    px-4</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    md:px-16</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    py-6</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    flex</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    flex-row</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    items-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    transition</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    duration-500</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    bg-zinc-900</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    bg-opacity-90</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">className</span>=<span class="string">&quot;h-4 lg:h-7&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/images/logo.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Logo&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    flex-row</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    ml-8</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    gap-7</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    hidden</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    lg:flex</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                &gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">NavbarItem</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Navbar</span>;</span><br></pre></td></tr></table></figure></p>
<p>接着在<code>components</code>中定义<code>NavbarItem.tsx</code>，写出其骨架：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">NavbarItem</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">NavbarItem</span>;</span><br></pre></td></tr></table></figure></p>
<p>接着丰满其中的细节：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">NavbarItemProps</span> &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NavbarItem</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">NavbarItemProps</span>&gt; = <span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    label</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;text-white cursor-pointer hover:text-gray-300 trasition&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;label&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">NavbarItem</span>;</span><br></pre></td></tr></table></figure></p>
<p>需要从<code>Navbar.tsx</code>中传入label: <code>&lt;NavbarItem label=&quot;Home&quot; /&gt;</code>，并依照同样的方式创建另外几个导航组件：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">NavbarItem</span> label=<span class="string">&quot;Home&quot;</span> /&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">NavbarItem</span> <span class="attr">label</span>=<span class="string">&quot;Series&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">NavbarItem</span> <span class="attr">label</span>=<span class="string">&quot;Films&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">NavbarItem</span> <span class="attr">label</span>=<span class="string">&quot;New &amp; Popular&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">NavbarItem</span> <span class="attr">label</span>=<span class="string">&quot;My List&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">NavbarItem</span> <span class="attr">label</span>=<span class="string">&quot;Browse by languages&quot;</span> /&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;lg:hidden flex flex-row items-center gap-2 ml-8 cursor-pointer relative&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;text-white text-sm&quot;</span>&gt;</span>Browse<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>小屏幕时，只出现Browse，不出现其他<code>navagation component</code>。接着去查找icons: <a target="_blank" rel="noopener" href="https://react-icons.github.io/react-icons/。找到一个向下展开的小箭头，在`Navbar.tsx`中引入并使用这个小箭头：">https://react-icons.github.io/react-icons/。找到一个向下展开的小箭头，在`Navbar.tsx`中引入并使用这个小箭头：</a><br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BsChevronDown</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-icons/bs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">BsChevronDown</span> <span class="attr">className</span>=<span class="string">&quot;text-white transition&quot;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>接着创建手机端（小屏幕）的菜单。先在<code>components</code>中创建<code>MobileMenu.tsx</code>，在其中写以下的代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MobileMenuProps</span> &#123;</span><br><span class="line">    visible?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MobileMenu</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">MobileMenuProps</span>&gt; = <span class="function">(<span class="params">&#123; visible &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!visible) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;bg-black w-56 absolute top-8 left-0 py-5 flex-col border-2 border-gray-800 flex&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;flex flex-col gap-4&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;px-3 text-center text-white hover:underline&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    Home</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MobileMenu</span>;</span><br></pre></td></tr></table></figure></p>
<p>然后在<code>Navbar.tsx</code>中引入<code>MobileMenu</code>。并<strong>实现手机（小屏幕）上点击browse展开出home的功能</strong>。<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [showMobileMenu, setShowMobileMenu] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> toggleMobileMenu = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setShowMobileMenu</span>(<span class="function">(<span class="params">current</span>) =&gt;</span> !current);</span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">MobileMenu</span> <span class="attr">visible</span>=<span class="string">&#123;showMobileMenu&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>对于上述代码的解释：这段代码是使用React Hooks编写的，主要用于在React组件中管理和切换移动设备菜单的显示状态。具体来说，这段代码定义了一个状态变量<code>showMobileMenu</code>和一个切换该状态的函数<code>toggleMobileMenu</code>。下面是这段代码的详细解释：</p>
<p><code>useState</code> 钩子</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [showMobileMenu, setShowMobileMenu] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><code>useState</code>是一个React Hook，允许在函数组件中添加状态。这里，它被用来定义一个名为<code>showMobileMenu</code>的状态变量，用于跟踪移动菜单是否显示。该状态的初始值为<code>false</code>，意味着菜单默认是不显示的。</li>
<li><code>setShowMobileMenu</code>是一个函数，用于更新<code>showMobileMenu</code>状态的值。当调用这个函数并传入一个新的值时，组件会重新渲染，并且<code>showMobileMenu</code>的值会更新为传入的新值。</li>
</ul>
<p><code>useCallback</code> 钩子</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> toggleMobileMenu = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setShowMobileMenu</span>(<span class="function">(<span class="params">current</span>) =&gt;</span> !current);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>
<ul>
<li><code>useCallback</code>是另一个React Hook，它返回一个记忆化的回调函数。这个回调函数只会在依赖项数组（这里是空数组<code>[]</code>）中的值发生变化时才会更新。在这个例子中，由于依赖项数组为空，<code>toggleMobileMenu</code>函数在组件的整个生命周期内保持不变。</li>
<li><code>toggleMobileMenu</code>函数的作用是调用<code>setShowMobileMenu</code>来切换<code>showMobileMenu</code>状态的值。它通过传递一个函数给<code>setShowMobileMenu</code>，这个函数接收当前的状态值<code>current</code>作为参数，并返回其相反值<code>!current</code>。这样，如果菜单当前是显示的（<code>true</code>），调用<code>toggleMobileMenu</code>会将其隐藏（设为<code>false</code>），反之亦然。</li>
</ul>
<p>总结</p>
<p>这段代码的主要目的是控制移动菜单的显示状态。通过点击或触发某个事件来调用<code>toggleMobileMenu</code>函数，可以在显示和隐藏移动菜单之间切换，从而为用户提供一个响应式的导航体验。这种模式在开发响应式Web应用时非常常见，特别是在需要改进移动设备上的用户界面和交互时。</p>
<p>进入<code>MobileMenu.tsx</code>中，加入一些新的class。<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">&#x27;px-3 text-center text-white hover:underline&#x27;</span>&gt;</span><br><span class="line">    <span class="title class_">Home</span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;px-3 text-center text-white hover:underline&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    Series</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;px-3 text-center text-white hover:underline&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    Films</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;px-3 text-center text-white hover:underline&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    New &amp; Popular</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;px-3 text-center text-white hover:underline&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    My List</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;px-3 text-center text-white hover:underline&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    Browse by Languages</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>这样点开browse就会展开上述的内容。接下来是<code>profile menu</code>。首先在导航组件中添加一个search（即一个放大镜形状的图标）。再添加一个铃铛，最后添加用户的默认头像，然后在用户头像处也添加一个向下展开的箭头。在<code>Navbar.tsx</code>中使用如下代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">&quot;flex flex-row ml-auto gap-7 items-center&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;text-gray-200 hover:text-gray-300 cursor-pointer transition&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">BsSearch</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;text-gray-200 hover:text-gray-300 cursor-pointer transition&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">BsBell</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;flex flex-row items-center gap-2 cursor-pointer relative&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;w-6 h-6 lg:w-10 lg:h-10 rounded-md overflow-hidden&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/images/default-blue.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">BsChevronDown</span> <span class="attr">className</span>=<span class="string">&quot;text-white transition&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>再添加<code>AccountMenu</code>。先在components中定义<code>AccountMenu.tsx</code>，在其中写一个骨架：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">AccountMenu</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">AccountMenu</span>;</span><br></pre></td></tr></table></figure></p>
<p>然后再在<code>Navbar.tsx</code>中引入<code>AccountMenu</code>。在<code>AccountMenu.tsx</code>中写入具体的内容：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; signOut &#125; <span class="keyword">from</span> <span class="string">&quot;next-auth/react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">AccountMenuProps</span> &#123;</span><br><span class="line">    <span class="attr">visible</span>: <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AccountMenu</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">AccountMenuProps</span>&gt; = <span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    visible</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!visible) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;bg-black w-56 absolute top-14 right-0 py-5 flex-col border-2 border-gray-800 flex&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;flex flex-col gap-3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;px-3 group/item flex flex-row gap-3 items-center w-full&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">img</span> <span class="attr">className</span>=<span class="string">&quot;w-8 rounded-md&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/images/default-blue.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;text-white text-sm group-hover/item:underline&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        Username</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">AccountMenu</span>;</span><br></pre></td></tr></table></figure></p>
<p>在<code>Navbar.tsx</code>中加入<code>&lt;AccountMenu visible/&gt;</code>，让<code>AccountMenu</code>。接下来再在<code>AccountMenu.tsx</code>中加入signOut按钮。<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;bg-black w-56 absolute top-14 right-0 py-5 flex-col border-2 border-gray-800 flex&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;flex flex-col gap-3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;px-3 group/item flex flex-row gap-3 items-center w-full&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">className</span>=<span class="string">&quot;w-8 rounded-md&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/images/default-blue.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;text-white text-sm group-hover/item:underline&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    Username</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">hr</span> <span class="attr">className</span>=<span class="string">&quot;bg-gray-600 border-0 h-px my-4&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> signOut()&#125; className=&quot;px-3 text-center text-white text-sm hover:underline&quot;&gt;</span></span><br><span class="line"><span class="language-xml">                Sign out of Netflix</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>然后还需要加入展开<code>AccountMenu</code>和收起<code>AccountMenu</code>的功能。在<code>Navbar.tsx</code>中加入代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [showAccountMenu, setShowAccountMenu] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> toggleAccountMenu = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">setShowAccountMenu</span>(<span class="function">(<span class="params">current</span>) =&gt;</span> !current);</span><br><span class="line">    &#125;, []);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;toggleAccountMenu&#125;</span> <span class="attr">className</span>=<span class="string">&quot;flex flex-row items-center gap-2 cursor-pointer relative&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;w-6 h-6 lg:w-10 lg:h-10 rounded-md overflow-hidden&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/images/default-blue.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">BsChevronDown</span> <span class="attr">className</span>=<span class="string">&quot;text-white transition&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">AccountMenu</span> <span class="attr">visible</span>=<span class="string">&#123;showAccountMenu&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>然后加入旋转 控制<code>AccountMenu</code>展开和收起的箭头的功能。<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">BsChevronDown</span> className=&#123;<span class="string">`text-white transition <span class="subst">$&#123;showAccountMenu ? <span class="string">`rotate-180`</span> : <span class="string">`rotate-0`</span>&#125;</span>`</span>&#125; /&gt;</span><br></pre></td></tr></table></figure></p>
<p>同理，对控制<code>browse</code>的箭头也做相同的处理。<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">BsChevronDown</span> className=&#123;<span class="string">`text-white transition <span class="subst">$&#123;showMobileMenu ? <span class="string">`rotate-180`</span> : <span class="string">`rotate-0`</span>&#125;</span>`</span>&#125; /&gt;</span><br></pre></td></tr></table></figure></p>
<p>现在想加一个特效：向下滑动时页面变黑，其他情况下页面透明。在<code>Navbar.tsx</code>中加入以下代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [showBackground, setShowBackground] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleScroll</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">scrollY</span> &gt;= <span class="variable constant_">TOP_OFFSET</span>) &#123;</span><br><span class="line">            <span class="title function_">setShowBackground</span>(<span class="literal">true</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">setShowBackground</span>(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, handleScroll); <span class="comment">// listen to scroll event</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, handleScroll); <span class="comment">// remove listener</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line">    &lt;nav className=&quot;w-full fixed z-40&quot;&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">            className=&#123;`</span><br><span class="line">                px-4</span><br><span class="line">                md:px-16</span><br><span class="line">                py-6</span><br><span class="line">                flex</span><br><span class="line">                flex-row</span><br><span class="line">                items-center</span><br><span class="line">                transition</span><br><span class="line">                duration-500</span><br><span class="line">                $&#123;showBackground ? &#x27;bg-zinc-900 bg-opacity-90&#x27; : &#x27;&#x27;&#125;</span><br><span class="line"></span><br><span class="line">            `&#125;</span><br></pre></td></tr></table></figure></p>
<p>加上这些代码后，当滚动页面时，导航组件都是透明的，但当开始滑动鼠标滚轮时，导航组件的背景变为黑色。<br>可以在<code>index.sh</code>中添加代码来测试这个功能：</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Navbar</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;bg-gray-500&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-96&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>添加完上述代码后，页面可以滚动，发现功能是正常的。</p>
<h2 id="Billboard-Component-Random-Movie-Endpoint"><a href="#Billboard-Component-Random-Movie-Endpoint" class="headerlink" title="Billboard Component, Random Movie Endpoint"></a>Billboard Component, Random Movie Endpoint</h2><p>每次会随机加载一部电影。进入github仓库，打开<code>movies.json</code>。将其中的电影全部加入到数据库中。<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">   <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Big Buck Bunny&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;Three rodents amuse themselves by harassing creatures of the forest. However, when they mess with a bunny, he decides to teach them a lesson.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;videoUrl&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;thumbnailUrl&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://upload.wikimedia.org/wikipedia/commons/7/70/Big.Buck.Bunny.-.Opening.Screen.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;genre&quot;</span><span class="punctuation">:</span><span class="string">&quot;Comedy&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;duration&quot;</span><span class="punctuation">:</span><span class="string">&quot;10 minutes&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Sintel&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;A lonely young woman, Sintel, helps and befriends a dragon, whom she calls Scales. But when he is kidnapped by an adult dragon, Sintel decides to embark on a dangerous quest to find her lost friend Scales.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;videoUrl&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/Sintel.mp4&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;thumbnailUrl&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://uhdtv.io/wp-content/uploads/2020/10/Sintel-3.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;genre&quot;</span><span class="punctuation">:</span><span class="string">&quot;Adventure&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;duration&quot;</span><span class="punctuation">:</span><span class="string">&quot;15 minutes&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Tears of Steel&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;In an apocalyptic future, a group of soldiers and scientists takes refuge in Amsterdam to try to stop an army of robots that threatens the planet.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;videoUrl&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/TearsOfSteel.mp4&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;thumbnailUrl&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://mango.blender.org/wp-content/uploads/2013/05/01_thom_celia_bridge.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;genre&quot;</span><span class="punctuation">:</span><span class="string">&quot;Action&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;duration&quot;</span><span class="punctuation">:</span><span class="string">&quot;12 minutes&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Elephant&#x27;s Dream&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;Friends Proog and Emo journey inside the folds of a seemingly infinite Machine, exploring the dark and twisted complex of wires, gears, and cogs, until a moment of conflict negates all their assumptions.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;videoUrl&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;thumbnailUrl&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://download.blender.org/ED/cover.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;genre&quot;</span><span class="punctuation">:</span><span class="string">&quot;Sci-Fi&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;duration&quot;</span><span class="punctuation">:</span><span class="string">&quot;15 minutes&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure></p>
<p>上述json文件中的数据格式和<code>schema.prisma</code>中的movies数据类型中定义的内容相同，除了缺少由mongodb产生的id。在mongodb网站中选择database-browse collections-movie-insert document，将json文件中的内容粘贴进去即可。现在就完成了对数据模型movie的修改。</p>
<p>现在创建一条新的路径：<code>random</code>。在<code>pages/api/random.ts</code>中写下以下的代码：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// random movie will be loaded every time we refresh the page</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NextApiRequest</span>, <span class="title class_">NextApiResponse</span> &#125; <span class="keyword">from</span> <span class="string">&quot;next&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> prismadb <span class="keyword">from</span> <span class="string">&#x27;@/lib/prismadb&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> serverAuth <span class="keyword">from</span> <span class="string">&quot;@/lib/serverAuth&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params">req: NextApiRequest, res: NextApiResponse</span>) &#123;</span><br><span class="line">    <span class="comment">// limit request method to GET</span></span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> !== <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">405</span>).<span class="title function_">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// try and catch block</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// check if the user log in</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">serverAuth</span>(req);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> movieCount = <span class="keyword">await</span> prismadb.<span class="property">movie</span>.<span class="title function_">count</span>();</span><br><span class="line">        <span class="keyword">const</span> randomIndex = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * movieCount); <span class="comment">// a random integar</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> randomMovies = <span class="keyword">await</span> prismadb.<span class="property">movie</span>.<span class="title function_">findMany</span>(&#123;</span><br><span class="line">            <span class="attr">take</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">skip</span>: randomIndex</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(randomMovies[<span class="number">0</span>]); <span class="comment">// take only one movies</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">end</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在<code>hooks/useBillboard.ts</code>中写下以下的代码，避免对首页推荐电影的重复加载：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useSWR <span class="keyword">from</span> <span class="string">&quot;swr&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> fetcher <span class="keyword">from</span> <span class="string">&quot;@/lib/fetcher&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useBillboard</span> =(<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data, error, isLoading &#125; = <span class="title function_">useSWR</span>(<span class="string">&#x27;/api/random&#x27;</span>, fetcher, &#123;</span><br><span class="line">        <span class="comment">// static data only load once the user visits the page</span></span><br><span class="line">        <span class="comment">// not every time they lose focus out of the window</span></span><br><span class="line">        <span class="attr">revalidateIfStale</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">revalidateOnFocus</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">revalidateOnReconnect</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        data,</span><br><span class="line">        error,</span><br><span class="line">        isLoading,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useBillboard;</span><br></pre></td></tr></table></figure></p>
<p>在<code>components</code>中新建<code>Billboard.tsx</code>，并在其中搭建一个骨架：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Billboard</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Billboard</span>;</span><br></pre></td></tr></table></figure></p>
<p>然后在<code>index.tsx</code>中引入<code>Billboard</code>。接着在<code>Billboard.tsx</code>中填入具体的内容，目的是fetch the data for a random movie。<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useBillboard <span class="keyword">from</span> <span class="string">&quot;@/hooks/useBillboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Billboard</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="title function_">useBillboard</span>();</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Billboard</span>;</span><br></pre></td></tr></table></figure></p>
<p>可以打开网页的调试界面：network-random-preview，就可以看到随机选择的电影的信息。接着继续写<code>Billboard.tsx</code>，在Billboard中添加随机的电影、电影名、电影介绍和More info按钮：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useBillboard <span class="keyword">from</span> <span class="string">&quot;@/hooks/useBillboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AiOutlineInfoCircle</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-icons/ai&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Billboard</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="title function_">useBillboard</span>();</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;relative h-[56.25vw]&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">video</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    w-full</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    h-[56.25vw]</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    object-cover</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    brightness-[60%]</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">autoPlay</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">muted</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">loop</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">poster</span>=<span class="string">&#123;data?.thumbnailUrl&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">src</span>=<span class="string">&#123;data?.videoUrl&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">video</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;absolute top-[30%] md:top-[40%] ml-4 md:ml-16&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    text-white</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    text-1xl </span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    md:text-5xl </span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    h-full </span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    w-[50%] </span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    lg:text-6xl </span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    font-bold </span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    drop-shadow-xl</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    &quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;data?.title&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    text-white</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    text-[8px]</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    md:text-lg</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    mt-3</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    md:mt-8</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    w-[90%]</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    md:w-[80%]</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    lg:w-[50%]</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    drop-shadow-xl</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                &quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;data?.description&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;flex flex-row items-center mt-3 md:mt-4 gap-3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            bg-white</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            text-white</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            bg-opacity-30</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            rounded-md</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            py-1 md:py-2</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            px-2 md:px-4</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            w-auto</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            text-xs lg:text-lg</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            font-semibold</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            flex</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            flex-row</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            items-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            hover:bg-opacity-20</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            transition</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                        &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    &gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">AiOutlineInfoCircle</span> <span class="attr">className</span>=<span class="string">&quot;mr-1&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                        More Info</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Billboard</span>;</span><br></pre></td></tr></table></figure></p>
<p>本节到此结束，效果图如下所示：<br><img src="https://github.com/yfchenkeepgoing/image/blob/main/Snipaste_2024-02-27_04-40-46.png?raw=true" alt="Snipaste_2024-02-27_04-40-46.png"></p>
<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>await和async的区别和联系：在TypeScript中，<code>async</code>和<code>await</code>关键字一起使用，作为处理异步操作的一种方式，主要用于替代传统的回调函数和Promise。它们两者之间有着明确的区别和各自的用途：</p>
<h3 id="async"><a href="#async" class="headerlink" title="async"></a>async</h3><ul>
<li><code>async</code>关键字用于声明一个异步函数，它让函数自动返回一个Promise。这意味着，当你在一个函数声明前加上<code>async</code>，这个函数就会返回一个Promise，而不是直接返回值。</li>
<li>使用<code>async</code>，你可以在函数内部使用<code>await</code>表达式。</li>
<li><code>async</code>函数可以包含零个或多个<code>await</code>表达式。</li>
</ul>
<p>例子：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 函数返回一个Promise</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;data&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个例子中，<code>fetchData</code>函数返回一个解析为字符串”data”的Promise。</p>
<h3 id="await"><a href="#await" class="headerlink" title="await"></a>await</h3><ul>
<li><code>await</code>关键字用于等待一个Promise解析，它只能在<code>async</code>函数内部使用。</li>
<li>当<code>await</code>前面的Promise被解析后，函数执行会继续，<code>await</code>表达式的结果就是Promise解析的值。</li>
<li>使用<code>await</code>可以让异步代码看起来像是同步代码，这使得代码更容易理解和维护。</li>
</ul>
<p>例子：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">showData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetchData</span>(); <span class="comment">// 等待fetchData解析</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个例子中，<code>showData</code>函数内部调用了<code>fetchData</code>函数，并在其Promise解析之后继续执行，打印出解析后的数据。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li><code>async</code>是一个使函数返回Promise的修饰符，而<code>await</code>是用于等待Promise解析的操作符。</li>
<li><code>await</code>只能在<code>async</code>函数内部使用。</li>
<li>它们一起使用提供了一种更简洁和直观的方式来处理JavaScript中的异步操作，避免了回调地狱（Callback Hell）的问题。</li>
</ul>
<h2 id="Movie-List-amp-Movie-Card-Components-Movies-Endpoint-Cool-hover-effect"><a href="#Movie-List-amp-Movie-Card-Components-Movies-Endpoint-Cool-hover-effect" class="headerlink" title="Movie List &amp; Movie Card Components, Movies Endpoint, Cool hover effect"></a>Movie List &amp; Movie Card Components, Movies Endpoint, Cool hover effect</h2><p>在pages/api中创建一个新的movies文件夹。在其中创建<code>index.ts</code>，并在其中写入这个api的具体内容：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NextApiRequest</span>, <span class="title class_">NextApiResponse</span> &#125; <span class="keyword">from</span> <span class="string">&quot;next&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> prismadb <span class="keyword">from</span> <span class="string">&#x27;@/lib/prismadb&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> serverAuth <span class="keyword">from</span> <span class="string">&#x27;@/lib/serverAuth&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params">req: NextApiRequest, res: NextApiResponse</span>) &#123;</span><br><span class="line">    <span class="comment">// this api call only get request method</span></span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> !== <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">405</span>).<span class="title function_">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// try and catch block</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">serverAuth</span>(req); <span class="comment">// authenticate this route</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// load all the movies</span></span><br><span class="line">        <span class="keyword">const</span> movies = <span class="keyword">await</span> prismadb.<span class="property">movie</span>.<span class="title function_">findMany</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(movies);</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">end</span>();</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接着再创建一个hook。在hook文件夹中创建<code>useMovieList.ts</code>。并写入以下代码：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useSWR <span class="keyword">from</span> <span class="string">&quot;swr&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> fetcher <span class="keyword">from</span> <span class="string">&quot;@/lib/fetcher&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useMovieList</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data, error, isLoading &#125;  = <span class="title function_">useSWR</span>(<span class="string">&#x27;api/movies&#x27;</span>, fetcher, &#123;</span><br><span class="line">        <span class="comment">// 不需要重新验证</span></span><br><span class="line">        <span class="attr">revalidateIfStale</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">revalidateOnFocus</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">revalidateOnReconnect</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        data,</span><br><span class="line">        error,</span><br><span class="line">        isLoading</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useMovieList;</span><br></pre></td></tr></table></figure></p>
<p>接着进入<code>pages/index.tsx</code>，加入以下代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">&quot;pb-40&quot;</span>&gt;</span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">MovieList</span> /&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>由于我们有多个MovieList，因此需要将MovieList包裹在div中。接着我们创建MovieList。在<code>components</code>中创建<code>MovieList.tsx</code>，并在其中搭建一个骨架：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">MovieList</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MovieList</span>;</span><br></pre></td></tr></table></figure></p>
<p>接着丰满其中的细节：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; isEmpty &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MovieListProps</span> &#123;</span><br><span class="line">    <span class="attr">data</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;[]; <span class="comment">// type: array</span></span><br><span class="line">    <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MovieList</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">MovieListProps</span>&gt; = <span class="function">(<span class="params">&#123; data, title &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do not render empty data</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isEmpty</span>(data)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;px-4 md:px-12 mt-4 space-y-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;text-white text-md md:text-xl lg:text-2xl font-semibold mb-4&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;title&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;grid grid-cols-4 gap-2&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;data.map((movie) =&gt; (</span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;movie.id&#125;</span>&gt;</span>movie<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    ))&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MovieList</span>;</span><br></pre></td></tr></table></figure></p>
<p>记得安装必要的库：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install lodash</span><br><span class="line">npm install -D @types/lodash</span><br></pre></td></tr></table></figure></p>
<p>接着在<code>pages/index.tsx</code>中给<code>MovieList</code>传入必要的参数：</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="attr">data</span>: movies = [] &#125; = <span class="title function_">useMovieList</span>(); <span class="comment">// use the newly created hook</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;pb-40&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">MovieList</span> <span class="attr">title</span>=<span class="string">&quot;Trending Now&quot;</span> <span class="attr">data</span>=<span class="string">&#123;movies&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>产生了如下效果：<br><img src="https://github.com/yfchenkeepgoing/image/blob/main/Snipaste_2024-02-28_23-51-30.png?raw=true" alt="Snipaste_2024-02-28_23-51-30.png"></p>
<p>现在将黑色的movies小字转换成实际的电影，并用上炫酷的Tailwind hover效果。在<code>MovieList.tsx</code>中加入下面的代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">MovieCard</span> key=&#123;movie.<span class="property">id</span>&#125; data=&#123;movie&#125; /&gt;</span><br></pre></td></tr></table></figure></p>
<p>接着在<code>components</code>文件夹中创建<code>MovieCard.tsx</code>文件。填入以下的骨架：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MovieCardProps</span> &#123;</span><br><span class="line">    <span class="attr">data</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MovieCard</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">MovieCardProps</span>&gt; = <span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    data</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            </span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MovieCard</span>;</span><br></pre></td></tr></table></figure></p>
<p>接着继续丰满上述代码的细节：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BsFillPlayFill</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-icons/bs&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MovieCardProps</span> &#123;</span><br><span class="line">    <span class="attr">data</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MovieCard</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">MovieCardProps</span>&gt; = <span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    data</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;group bg-zinc-900 col-span relative h-[12vw]&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">img</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            cursor-pointer</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            object-cover</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            transition</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            duration</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            shadow-xl</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            rounded-md</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            group-hover:opacity-90</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            sm:group-hover:opacity-0</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            delay-300</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            w-full</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            h-[12vw]</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">src</span>=<span class="string">&#123;data.thumbnailUrl&#125;</span> <span class="attr">alt</span>=<span class="string">&quot;Thumbnail&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    opacity-0</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    absolute</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    top-0</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    transition</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    duration-200</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    z-10</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    invisible</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    sm:visible</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    delay-300</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    w-full</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    scale-0</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    group-hover:scale-110</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    group-hover:-translate-y-[6vw]</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    group-hover:translate-x-[2vw]</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    group-hover:opacity-100</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">img</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    cursor-pointer</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    object-cover</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    transition</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    duration</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    shadow-xl</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    rounded-t-md</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    w-full</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    h-[12vw]</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">src</span>=<span class="string">&#123;data.thumbnailUrl&#125;</span> <span class="attr">alt</span>=<span class="string">&quot;Thumbnail&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                        z-10</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                        bg-zinc-800</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                        p-2</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                        lg:p-4</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                        absolute</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                        w-full</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                        transition</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                        shadow-md</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                        rounded-b-md</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                &gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;flex flex-row items-center gap-3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            cursor-pointer</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            w-6</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            h-6</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            lg:w-10</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            lg:h-10</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            bg-white</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            rounded-full</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            flex</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            justify-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            items-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            transition</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            hover:bg-neutral-300</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                            &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;&#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">BsFillPlayFill</span> <span class="attr">size</span>=<span class="string">&#123;30&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;text-green-400 font-semibold mt-4&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        New <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;text-white&quot;</span>&gt;</span>2024<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;flex flex-row mt-4 gap-2 items-center&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;text-white text-[10px] lg:text-sm&quot;</span>&gt;</span>&#123;data.duration&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;flex flex-row mt-4 gap-2 items-center&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;text-white text-[10px] lg:text-sm&quot;</span>&gt;</span>&#123;data.genre&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MovieCard</span>;</span><br></pre></td></tr></table></figure></p>
<p>最后实现的效果图如下所示：</p>
<p><img src="https://github.com/yfchenkeepgoing/image/blob/main/Snipaste_2024-02-29_02-48-28.png?raw=true" alt="Snipaste_2024-02-29_02-48-28.png"></p>
<h2 id="Favourites-My-List-functionality"><a href="#Favourites-My-List-functionality" class="headerlink" title="Favourites / My List functionality"></a>Favourites / My List functionality</h2><p>本节我们将实现favourite按钮，其在播放按钮的旁边。我们还将在Trending List下面实现My List，其中将只展示我们favourite的电影。在<code>pages/api/favorite.ts</code>中写下以下的代码：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// can handle both post request and delete request</span></span><br><span class="line"><span class="comment">// api to add and remove favourite ID in our list</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NextApiRequest</span>, <span class="title class_">NextApiResponse</span> &#125; <span class="keyword">from</span> <span class="string">&quot;next&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; without &#125; <span class="keyword">from</span> <span class="string">&quot;lodash&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> prismadb <span class="keyword">from</span> <span class="string">&#x27;@/lib/prismadb&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> serverAuth <span class="keyword">from</span> <span class="string">&quot;@/lib/serverAuth&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params">req: NextApiRequest, res: NextApiResponse</span>) &#123;</span><br><span class="line">    <span class="comment">// try and catch block</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// handle post request</span></span><br><span class="line">        <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; currentUser &#125; = <span class="keyword">await</span> <span class="title function_">serverAuth</span>(req); <span class="comment">// get curent user</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> &#123; movieId &#125; = req.<span class="property">body</span>; <span class="comment">// get movieId</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// check if the movieId is correct</span></span><br><span class="line">            <span class="keyword">const</span> existingMovie = <span class="keyword">await</span> prismadb.<span class="property">movie</span>.<span class="title function_">findUnique</span>(&#123;</span><br><span class="line">                <span class="attr">where</span>: &#123;</span><br><span class="line">                    <span class="attr">id</span>: movieId,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!existingMovie) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Invalid ID&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// update user and push movieId to their favoriteIds defined in schema.prisma</span></span><br><span class="line">            <span class="keyword">const</span> user = <span class="keyword">await</span> prismadb.<span class="property">user</span>.<span class="title function_">update</span>(&#123;</span><br><span class="line">                <span class="attr">where</span>: &#123;</span><br><span class="line">                    <span class="attr">email</span>: currentUser.<span class="property">email</span> || <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">data</span>: &#123;</span><br><span class="line">                    <span class="attr">favoriteIds</span>: &#123;</span><br><span class="line">                        <span class="attr">push</span>: movieId,</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(user);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// handle delete request when a user want to unfavorite a movie</span></span><br><span class="line">        <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&#x27;DELETE&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; currentUser &#125; = <span class="keyword">await</span> <span class="title function_">serverAuth</span>(req);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> &#123; movieId &#125; = req.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> existingMovie = <span class="keyword">await</span> prismadb.<span class="property">movie</span>.<span class="title function_">findUnique</span>(&#123;</span><br><span class="line">                <span class="attr">where</span>: &#123;</span><br><span class="line">                    <span class="attr">id</span>: movieId,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!existingMovie) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Invalid ID&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// a list of our current favorite IDs without the above movie id</span></span><br><span class="line">            <span class="keyword">const</span> updateFavoriteIds = <span class="title function_">without</span>(currentUser.<span class="property">favoriteIds</span>, movieId);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// update User information</span></span><br><span class="line">            <span class="keyword">const</span> updatedUser = <span class="keyword">await</span> prismadb.<span class="property">user</span>.<span class="title function_">update</span>(&#123;</span><br><span class="line">                <span class="attr">where</span>: &#123;</span><br><span class="line">                    <span class="attr">email</span>: currentUser.<span class="property">email</span> || <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">data</span>: &#123;</span><br><span class="line">                    <span class="attr">favoriteIds</span>: updateFavoriteIds,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(updatedUser);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">405</span>).<span class="title function_">end</span>(); </span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接下来创建一个<code>api route</code>，其将只加载我们最喜欢的电影列表。在<code>pages/api/favorites.ts</code>，写下如下的代码：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fetch all of our favorite movies</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NextApiRequest</span>, <span class="title class_">NextApiResponse</span> &#125; <span class="keyword">from</span> <span class="string">&quot;next&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> prismadb <span class="keyword">from</span> <span class="string">&#x27;@/lib/prismadb&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> serverAuth <span class="keyword">from</span> <span class="string">&quot;@/lib/serverAuth&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params">req:NextApiRequest, res: NextApiResponse</span>) &#123;</span><br><span class="line">    <span class="comment">// limit this route only to get method</span></span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> !== <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">405</span>).<span class="title function_">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// try and catch block</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; currentUser &#125; = <span class="keyword">await</span> <span class="title function_">serverAuth</span>(req);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// find all movies which have a relation to current user favorite IDs</span></span><br><span class="line">        <span class="keyword">const</span>  favoriteMovies  = <span class="keyword">await</span> prismadb.<span class="property">movie</span>.<span class="title function_">findMany</span>(&#123;</span><br><span class="line">            <span class="attr">where</span>: &#123;</span><br><span class="line">                <span class="attr">id</span>: &#123;</span><br><span class="line">                    <span class="attr">in</span>: currentUser?.<span class="property">favoriteIds</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(favoriteMovies);</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接着再写一个hook，用于加载最喜欢的电影列表。在<code>hooks/useFavorites.ts</code>中写入以下的代码：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useSWR <span class="keyword">from</span> <span class="string">&quot;swr&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> fetcher <span class="keyword">from</span> <span class="string">&quot;@/lib/fetcher&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useFavorites</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data, error, isLoading, mutate &#125; = <span class="title function_">useSWR</span>(<span class="string">&#x27;/api/favorites&#x27;</span>, fetcher, &#123;</span><br><span class="line">        <span class="attr">revalidateIfStale</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">revalidateOnFocus</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">revalidateOnReconnect</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        data,</span><br><span class="line">        error,</span><br><span class="line">        isLoading,</span><br><span class="line">        mutate</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useFavorites;</span><br></pre></td></tr></table></figure></p>
<p>再写一个组件：<code>components/FavoriteButton.tsx</code>，作为按钮：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useCallback, useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> useCurrentUser <span class="keyword">from</span> <span class="string">&quot;@/hooks/useCurrentUser&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useFavorites <span class="keyword">from</span> <span class="string">&quot;@/hooks/useFavorites&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">FavoriteButtonProps</span> &#123;</span><br><span class="line">    <span class="attr">movieId</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// only one parameter: movieId</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">FavoriteButton</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">FavoriteButtonProps</span>&gt; = <span class="function">(<span class="params">&#123; movieId &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">FavoriteButton</span>;</span><br></pre></td></tr></table></figure></p>
<p>将该按钮加在MovieCard中。在<code>components/MovieCard.tsx</code>中的播放按钮之后加入：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">FavoriteButton</span> movieId=&#123;data?.<span class="property">id</span>&#125; /&gt;</span><br></pre></td></tr></table></figure></p>
<p>补充知识：在JavaScript和TypeScript中，<code>?</code>操作符在这个上下文中被用作可选链（Optional Chaining）操作符。当你在一个对象后面加上<code>?</code>后跟属性名或方法，这意味着如果这个对象存在（即不是<code>null</code>或<code>undefined</code>），则会尝试访问该属性或方法；如果对象是<code>null</code>或<code>undefined</code>，则不会尝试访问该属性或方法，而是直接返回<code>undefined</code>。这避免了在访问深层嵌套对象属性时可能出现的类型错误。</p>
<p>接着写<code>components/FavoriteButton.tsx</code>：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useCallback, useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AiOutlinePlus</span>  &#125; <span class="keyword">from</span> <span class="string">&quot;react-icons/ai&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> useCurrentUser <span class="keyword">from</span> <span class="string">&quot;@/hooks/useCurrentUser&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useFavorites <span class="keyword">from</span> <span class="string">&quot;@/hooks/useFavorites&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">FavoriteButtonProps</span> &#123;</span><br><span class="line">    <span class="attr">movieId</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// only one parameter: movieId</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">FavoriteButton</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">FavoriteButtonProps</span>&gt; = <span class="function">(<span class="params">&#123; movieId &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            cursor-pointer</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            group/item</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            w-6</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            h-6</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            lg:w-10</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            lg:h-10</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            border-white</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            border-2</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            rounded-full</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            flex</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            justify-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            items-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            transition</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            hover:border-neutral-300</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        &quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">AiOutlinePlus</span> <span class="attr">className</span>=<span class="string">&quot;text-white&quot;</span> <span class="attr">size</span> =<span class="string">&#123;25&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">FavoriteButton</span>;</span><br></pre></td></tr></table></figure></p>
<p>然后在Trending Now列表以外再创建一个My Favorites列表。进入<code>pages/index.tsx</code>中，增加以下的代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="attr">data</span>: favorites = [] &#125; = <span class="title function_">useFavorites</span>(); <span class="comment">// use hook to get favorite movies</span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">MovieList</span> <span class="attr">title</span>=<span class="string">&quot;My List&quot;</span> <span class="attr">data</span>=<span class="string">&#123;favorites&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>由于目前还没有最喜欢的电影，因此My List为空。在<code>FavoriteButton.tsx</code>中添加以下代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="attr">mutate</span>: mutateFavorites &#125; = <span class="title function_">useFavorites</span>();</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">data</span>: currentUser, mutate &#125; = <span class="title function_">useCurrentUser</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// check if the favorite list of current user includes movieId</span></span><br><span class="line"><span class="keyword">const</span> isFavorite = useMemo (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> list = currentUser?.<span class="property">favoriteIds</span> || [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> list.<span class="title function_">include</span>(movieId);</span><br><span class="line">&#125;, [currentUser, movieId]); <span class="comment">// dependency in []</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// once we click the favorite, we will check if the current movie is favorited</span></span><br><span class="line"><span class="comment">// if yes, trigger the delete request</span></span><br><span class="line"><span class="comment">// if no, add the movie in the favorite list</span></span><br><span class="line"><span class="keyword">const</span> toggleFavorites = <span class="title function_">useCallback</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> response;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isFavorite) &#123;</span><br><span class="line">        response = <span class="keyword">await</span> axios.<span class="title function_">delete</span>(<span class="string">&#x27;/api/favorite&#x27;</span>, &#123; <span class="attr">data</span>: &#123; movieId &#125;&#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        response = <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="string">&#x27;/api/favorite&#x27;</span>, &#123; movieId &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// update the favorite list of current user</span></span><br><span class="line">    <span class="keyword">const</span> updatedFavoriteIds = response?.<span class="property">data</span>?.<span class="property">favoriteIds</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// mutate用于更新currentUser数据</span></span><br><span class="line">    <span class="title function_">mutate</span>(&#123;</span><br><span class="line">        ...currentUser, <span class="comment">// 复制了currentUser对象中的所有属性到一个新对象中</span></span><br><span class="line">        <span class="comment">// 如果currentUser对象中已经存在favoriteIds属性，这一操作将会覆盖原有的值。如果不存在，就会添加一个新的favoriteIds属性</span></span><br><span class="line">        <span class="attr">favoriteIds</span>: updatedFavoriteIds,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">mutateFavorites</span>(); <span class="comment">// 来自useFavorites中的mutate，每次更新currentUser的favoriteIds的数据后，立即刷新</span></span><br><span class="line">&#125;, [movieId, isFavorite, currentUser, mutate, mutateFavorites]);</span><br></pre></td></tr></table></figure></p>
<p>实现了上述函数后，我们要让favorite按钮变得可交互。添加以下代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Icon</span> = isFavorite ? <span class="title class_">AiOutlineCheck</span> : <span class="title class_">AiOutlinePlus</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;toggleFavorites&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        cursor-pointer</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        group/item</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        w-6</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        h-6</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        lg:w-10</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        lg:h-10</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        border-white</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        border-2</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        rounded-full</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        flex</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        justify-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        items-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        transition</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        hover:border-neutral-300</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">    &quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">className</span>=<span class="string">&quot;text-white&quot;</span> <span class="attr">size</span> =<span class="string">&#123;25&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>这样点击Trending Now列表上的电影上的加号时，其就会被添加到My List，然后加号会变成勾。这样一部电影就被选择为favorite了。同理，在My List中点击打勾符号，电影就会被取消选中，从My List里面消失。但目前该功能还是有bug。解决方法似乎是：<a target="_blank" rel="noopener" href="https://github.com/nextauthjs/next-auth/issues/7199，需要将getSession替换为getServerSession。替换后问题得到了解决。">https://github.com/nextauthjs/next-auth/issues/7199，需要将getSession替换为getServerSession。替换后问题得到了解决。</a></p>
<p>详细解决步骤：在<code>[..nextauth].ts</code>中添加<code>AuthOptions</code>，然后在<code>serverAuth.ts</code>中使用getServerSession替换getSession，并给getServerSession传入三个参数：req, res, authOptions，最后在所有用到serverAuth的api中将<code>const &#123; currentUser &#125; = await serverAuth(req)</code>替换为<code>const &#123; currentUser &#125; = await serverAuth(req, res);</code>。即可以修复上述bug。</p>
<h2 id="Play-Button-Video-Player-Single-Movie-Endpoint"><a href="#Play-Button-Video-Player-Single-Movie-Endpoint" class="headerlink" title="Play Button, Video Player, Single Movie Endpoint"></a>Play Button, Video Player, Single Movie Endpoint</h2><p>在billboard中加入播放按钮。还要创建player route。</p>
<p>首先创建<code>pages/api/movies/[movieId].ts</code>，在其中写入代码：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NextApiRequest</span>, <span class="title class_">NextApiResponse</span> &#125; <span class="keyword">from</span> <span class="string">&quot;next&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> prismadb <span class="keyword">from</span> <span class="string">&#x27;@/lib/prismadb&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> serverAuth <span class="keyword">from</span> <span class="string">&quot;@/lib/serverAuth&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params">req: NextApiRequest, res: NextApiResponse</span>) &#123;</span><br><span class="line">    <span class="comment">// limit to get request</span></span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> !== <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">405</span>).<span class="title function_">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// try and catch block</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">serverAuth</span>(req, res);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> &#123; movieId &#125; = req.<span class="property">query</span>; <span class="comment">// search for movie Id</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> movieId !== <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Invalid ID&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!movieId) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Invalid ID&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// find movie using movieId</span></span><br><span class="line">        <span class="keyword">const</span> movie = <span class="keyword">await</span> prismadb.<span class="property">movie</span>.<span class="title function_">findUnique</span>(&#123;</span><br><span class="line">            <span class="attr">where</span>: &#123;</span><br><span class="line">                <span class="attr">id</span>: movieId</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!movie) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Invalid ID&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(movie);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接着创建一个hook。创建<code>hooks/useMovie.ts</code>，在其中写入代码：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useSWR <span class="keyword">from</span> <span class="string">&quot;swr&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> fetcher <span class="keyword">from</span> <span class="string">&quot;@/lib/fetcher&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// parameter: id，该id会被/api/movies/[movieId].ts中的[movieId]解析</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useMovie</span> = (<span class="params">id?: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; </span><br><span class="line">        data, </span><br><span class="line">        error, </span><br><span class="line">        isLoading </span><br><span class="line">    &#125; = <span class="title function_">useSWR</span>(id ? <span class="string">`/api/movies/<span class="subst">$&#123;id&#125;</span>`</span> : <span class="literal">null</span>, fetcher, &#123;</span><br><span class="line">        <span class="attr">revalidateIfStale</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">revalidateOnFocus</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">revalidateOnReconnect</span>: <span class="literal">false</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        data,</span><br><span class="line">        error,</span><br><span class="line">        isLoading,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useMovie;</span><br></pre></td></tr></table></figure></p>
<p>接着创建一个play按钮的component。创建<code>components/PlayButton.tsx</code>，在其中写入骨架：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BsFillPlayFill</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-icons/bs&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;next/router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PlayButtonProps</span> &#123;</span><br><span class="line">    <span class="attr">movieId</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PlayButton</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">PlayButtonProps</span>&gt; = <span class="function">(<span class="params">&#123; movieId &#125;</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> router = <span class="title function_">useRouter</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PlayButton</span>;</span><br></pre></td></tr></table></figure></p>
<p>接着在<code>components/Billboard.tsx</code>中加入上述组件。在写有more info字样的按钮前加入：<code>&lt;PlayButton movieId=&#123;data?.id&#125; /&gt;</code>。接着继续丰满<code>components/PlayButton.tsx</code>中的细节：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BsFillPlayFill</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-icons/bs&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;next/router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PlayButtonProps</span> &#123;</span><br><span class="line">    <span class="attr">movieId</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PlayButton</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">PlayButtonProps</span>&gt; = <span class="function">(<span class="params">&#123; movieId &#125;</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> router = <span class="title function_">useRouter</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> router.push(`/watch/$&#123;movieId&#125;`)&#125;</span></span><br><span class="line"><span class="language-xml">            className=&quot;</span></span><br><span class="line"><span class="language-xml">                bg-white</span></span><br><span class="line"><span class="language-xml">                rounded-md</span></span><br><span class="line"><span class="language-xml">                py-1 md:py-2</span></span><br><span class="line"><span class="language-xml">                px-2 md:px-4</span></span><br><span class="line"><span class="language-xml">                w-auto</span></span><br><span class="line"><span class="language-xml">                text-xs lg:text-lg</span></span><br><span class="line"><span class="language-xml">                font-semibold</span></span><br><span class="line"><span class="language-xml">                flex</span></span><br><span class="line"><span class="language-xml">                flex-row</span></span><br><span class="line"><span class="language-xml">                items-center</span></span><br><span class="line"><span class="language-xml">                hover:bg-neutral-300</span></span><br><span class="line"><span class="language-xml">                transition</span></span><br><span class="line"><span class="language-xml">            &quot;</span></span><br><span class="line"><span class="language-xml">        &gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">BsFillPlayFill</span> <span class="attr">size</span>=<span class="string">&#123;25&#125;</span> <span class="attr">className</span>=<span class="string">&quot;mr-1&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            Play</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PlayButton</span>;</span><br></pre></td></tr></table></figure></p>
<p>现在就实现了点击播放按钮，跳转到另一个页面。接着在MovieCard组件中也实现上述点击播放然后跳转的功能。进入<code>components/MovieCard.tsx</code>，在其中添加代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;next/router&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">useRouter</span>();</span><br><span class="line">onClick=&#123;<span class="function">() =&gt;</span> router.<span class="title function_">push</span>(<span class="string">`/watch/<span class="subst">$&#123;data?.id&#125;</span>`</span>)&#125;&gt;</span><br></pre></td></tr></table></figure></p>
<p>现在需要具体写跳转到的页面。开始写<code>/watch</code>页面。创建<code>pages/watch/[movieId].tsx</code>，在其中写入以下的骨架：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// outside of api folder, so this is a client route</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> useMovie <span class="keyword">from</span> <span class="string">&quot;@/hooks/useMovie&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&quot;next/router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Watch</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> router = <span class="title function_">useRouter</span>();</span><br><span class="line">    <span class="keyword">const</span> &#123; movieId &#125; = router.<span class="property">query</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="title function_">useMovie</span>(movieId <span class="keyword">as</span> <span class="built_in">string</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Watch</span>;</span><br></pre></td></tr></table></figure></p>
<p>现在点击播放按钮，会跳转到一个空白页面。继续丰满上述代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// outside of api folder, so this is a client route</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AiOutlineArrowLeft</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-icons/ai&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useMovie <span class="keyword">from</span> <span class="string">&quot;@/hooks/useMovie&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&quot;next/router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Watch</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> router = <span class="title function_">useRouter</span>();</span><br><span class="line">    <span class="keyword">const</span> &#123; movieId &#125; = router.<span class="property">query</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="title function_">useMovie</span>(movieId <span class="keyword">as</span> <span class="built_in">string</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;h-screen w-screnn bg-black&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">nav</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    fixed</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    w-full</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    p-4</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    z-10</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    flex-row</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    items-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    gap-8</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    bg-black</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    bg-opacity-70</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">AiOutlineArrowLeft</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> router.push(&#x27;/&#x27;)&#125; className=&quot;text-white cursor-pointer&quot; size=&#123;40&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;text-white text-1xl md:text-3xl font-bold&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;font-light&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        Watching:</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;data?.title&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">video</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">autoPlay</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">controls</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">className</span>=<span class="string">&quot;h-full w-full&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">src</span>=<span class="string">&#123;data?.videoUrl&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Watch</span>;</span><br></pre></td></tr></table></figure></p>
<p>现在就实现了功能：点击播放按钮，跳转到播放视频的页面，播放视频的页面会自动加载视频的名字，并有一个返回按钮，点击之可以返回到homepage。播放视频的页面中的视频可以播放、暂停、拖动时间条。</p>
<h2 id="Info-Modal-Component"><a href="#Info-Modal-Component" class="headerlink" title="Info Modal Component"></a>Info Modal Component</h2><p>点击More Info按钮，会显示电影的信息。在Treanding Now下面会加一个展开按钮，会展开电影相关的信息。</p>
<p>创建<code>hooks/useInfoModel.ts</code>，并通过命令<code>npm install zustand</code>安装新的库。<code>zustand</code>是一个轻量化的全局状态管理库。在<code>useInfoModel.ts</code>中写入以下的代码：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; create &#125; <span class="keyword">from</span> <span class="string">&quot;zustand&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ModalStoreInterface</span> &#123;</span><br><span class="line">    movieId?: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">isOpen</span>: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">openModal</span>: <span class="function">(<span class="params">movieId: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">    <span class="attr">closeModal</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// hook</span></span><br><span class="line"><span class="keyword">const</span> useInfoModal = create&lt;<span class="title class_">ModalStoreInterface</span>&gt;(<span class="function">(<span class="params">set</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">movieId</span>: <span class="literal">undefined</span>,</span><br><span class="line">    <span class="attr">isOpen</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">openModal</span>: <span class="function">(<span class="params">movieId: <span class="built_in">string</span></span>) =&gt;</span> <span class="title function_">set</span>(&#123; <span class="attr">isOpen</span>: <span class="literal">true</span>, movieId &#125;),</span><br><span class="line">    <span class="attr">closeModal</span>: <span class="function">() =&gt;</span> <span class="title function_">set</span>(&#123; <span class="attr">isOpen</span>: <span class="literal">false</span>, <span class="attr">movieId</span>: <span class="literal">undefined</span>&#125;),</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useInfoModal;</span><br></pre></td></tr></table></figure></p>
<p>创建<code>components/InfoModal.tsx</code>，写入以下的代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useCallback, useEffect, useState&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AiOutlineClose</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-icons/ai&quot;</span>; <span class="comment">// close Button</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PlayButton</span> <span class="keyword">from</span> <span class="string">&quot;./PlayButton&quot;</span>; <span class="comment">// PlayButton</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">FavoriteButton</span> <span class="keyword">from</span> <span class="string">&quot;./FavoriteButton&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useInfoModal <span class="keyword">from</span> <span class="string">&quot;@/hooks/useInfoModal&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useMovie <span class="keyword">from</span> <span class="string">&quot;@/hooks/useMovie&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">InfoModalProps</span> &#123;</span><br><span class="line">    visible?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">onClose</span>: <span class="built_in">any</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">InfoModal</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">InfoModalProps</span>&gt; = <span class="function">(<span class="params">&#123; visible, onClose &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// a state for visible, visible is boolean so !! before it</span></span><br><span class="line">    <span class="keyword">const</span> [isVisible, setIsVisible] = <span class="title function_">useState</span>(!!visible);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fetch moveId</span></span><br><span class="line">    <span class="keyword">const</span> &#123; movieId &#125; = <span class="title function_">useInfoModal</span>();</span><br><span class="line">    <span class="comment">// fetch data from movie</span></span><br><span class="line">    <span class="keyword">const</span> &#123; data = &#123;&#125; &#125; = <span class="title function_">useMovie</span>(movieId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// use Effect</span></span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">setIsVisible</span>(!!visible); <span class="comment">// set visible on every new visible change that we get</span></span><br><span class="line">    &#125;, [visible]); <span class="comment">// visible in dependency</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleClose = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">setIsVisible</span>(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// a cool animation</span></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">onClose</span>();</span><br><span class="line">        &#125;, <span class="number">300</span>); <span class="comment">// 300 ms </span></span><br><span class="line">    &#125;, [onClose]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!visible) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">InfoModal</span>;</span><br></pre></td></tr></table></figure></p>
<p>在<code>pages/index.tsx</code>中加入<code>InfoModal</code>：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">InfoModal</span> <span class="keyword">from</span> <span class="string">&quot;@/components/InfoModal&quot;</span>;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">InfoModal</span> <span class="attr">visible</span> <span class="attr">onClose</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;&#125;&#125; /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>接下来继续丰满<code>InfoModal.tsx</code>：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useCallback, useEffect, useState&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AiOutlineClose</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-icons/ai&quot;</span>; <span class="comment">// close Button</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PlayButton</span> <span class="keyword">from</span> <span class="string">&quot;./PlayButton&quot;</span>; <span class="comment">// PlayButton</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">FavoriteButton</span> <span class="keyword">from</span> <span class="string">&quot;./FavoriteButton&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useInfoModal <span class="keyword">from</span> <span class="string">&quot;@/hooks/useInfoModal&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useMovie <span class="keyword">from</span> <span class="string">&quot;@/hooks/useMovie&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">InfoModalProps</span> &#123;</span><br><span class="line">    visible?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">onClose</span>: <span class="built_in">any</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">InfoModal</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">InfoModalProps</span>&gt; = <span class="function">(<span class="params">&#123; visible, onClose &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// a state for visible, visible is boolean so !! before it</span></span><br><span class="line">    <span class="keyword">const</span> [isVisible, setIsVisible] = <span class="title function_">useState</span>(!!visible);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fetch moveId</span></span><br><span class="line">    <span class="keyword">const</span> &#123; movieId &#125; = <span class="title function_">useInfoModal</span>();</span><br><span class="line">    <span class="comment">// fetch data from movie</span></span><br><span class="line">    <span class="keyword">const</span> &#123; data = &#123;&#125; &#125; = <span class="title function_">useMovie</span>(movieId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// use Effect</span></span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">setIsVisible</span>(!!visible); <span class="comment">// set visible on every new visible change that we get</span></span><br><span class="line">    &#125;, [visible]); <span class="comment">// visible in dependency</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleClose = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">setIsVisible</span>(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// a cool animation</span></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">onClose</span>();</span><br><span class="line">        &#125;, <span class="number">300</span>); <span class="comment">// 300 ms </span></span><br><span class="line">    &#125;, [onClose]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!visible) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                z-50</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                transition</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                duration-300</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                bg-black</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                bg-opacity-80</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                flex</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                justify-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                items-center</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                overflow-x-hidden</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                overflow-y-auto</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                fixed</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                inset-0</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    relative</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    w-auto</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    mx-auto</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    max-w-3xl</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    rounded-md</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    overflow-hidden</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">className</span>=<span class="string">&#123;</span>`</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        $&#123;<span class="attr">isVisible</span> ? &#x27;<span class="attr">scale-100</span>&#x27;<span class="attr">:</span> &#x27;<span class="attr">scale-0</span>&#x27;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">transform</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">duration-300</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">relative</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">flex-auto</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">bg-zinc-900</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">drop-shadow-md</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    `&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;relative h-96&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">video</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                    w-full</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                    brightness-[60%]</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                    object-cover</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                    h-full</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                                &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                <span class="attr">autoPlay</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                <span class="attr">muted</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                <span class="attr">loop</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                <span class="attr">poster</span>=<span class="string">&#123;data?.thumbnailUrl&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                <span class="attr">src</span>=<span class="string">&#123;data?.videoUrl&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            &gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">InfoModal</span>;</span><br></pre></td></tr></table></figure></p>
<p>产生了如下的效果：<br><img src="https://github.com/yfchenkeepgoing/image/blob/main/Snipaste_2024-03-05_06-42-52.png?raw=true" alt="Snipaste_2024-03-05_06-42-52.png"></p>
<p>接下来再给上面的黑色方框加上一个关闭按钮，并添加播放按钮和收藏按钮。在<code>InfoModal.tsx</code>中添加以下代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;div </span><br><span class="line">className=<span class="string">&quot;</span></span><br><span class="line"><span class="string">    cursor-pointer</span></span><br><span class="line"><span class="string">    absolute</span></span><br><span class="line"><span class="string">    top-3</span></span><br><span class="line"><span class="string">    right-3</span></span><br><span class="line"><span class="string">    h-10</span></span><br><span class="line"><span class="string">    w-10</span></span><br><span class="line"><span class="string">    rounded-full</span></span><br><span class="line"><span class="string">    bg-black</span></span><br><span class="line"><span class="string">    bg-opacity-70</span></span><br><span class="line"><span class="string">    flex</span></span><br><span class="line"><span class="string">    items-center</span></span><br><span class="line"><span class="string">    justify-center</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line">onClick=&#123;<span class="function">() =&gt;</span> &#123;&#125;&#125;&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">AiOutlineClose</span> <span class="attr">className</span>=<span class="string">&quot;text-white&quot;</span> <span class="attr">size</span>=<span class="string">&#123;20&#125;</span> /&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">    absolute</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">    bottom-[10%]</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">    left-10</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;text-white text-3xl md:text-4xl h-full lg:text-5xl font-bold mb-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;data?.title&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;flex flex-row gap-4 items-center&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">PlayButton</span> <span class="attr">movieId</span>=<span class="string">&#123;data?.id&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">FavoriteButton</span> <span class="attr">movieId</span>=<span class="string">&#123;data?.id&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>最后再加上New字样和电影的各类信息：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">&quot;px-12 py-8&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;text-green-400 font-semibold text-lg&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        New</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;text-white text-lg&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;data?.duration&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;text-white text-lg&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;data?.genre&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;text-white text-lg&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;data?.description&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>并加上点击关闭按钮实现关闭页面的功能，即在<code>onClick</code>函数中调用<code>handleClose</code>即可：<code>onClick=&#123;handleClose&#125;&gt;</code></p>
<p>然后在<code>pages/index.tsx</code>中实现对上述模块<code>InfoModal.tsx</code>的触发。<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; isOpen, closeModal &#125; = <span class="title function_">useInfoModal</span>(); <span class="comment">// use useInfoModal hook to trigger InfoModal </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">InfoModal</span> <span class="attr">visible</span>=<span class="string">&#123;isOpen&#125;</span> <span class="attr">onClose</span>=<span class="string">&#123;closeModal&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>现在需要实现在<code>billboard</code>中点击More Info按钮展现上述的<code>Info Modal</code>组件的功能。进入<code>components/Billboard.tsx</code>中，写入以下的代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; openModal &#125; = <span class="title function_">useInfoModal</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleOpenModal = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">openModal</span>(data?.<span class="property">id</span>);</span><br><span class="line">&#125;, [openModal, data?.<span class="property">id</span>]);</span><br><span class="line"></span><br><span class="line">onClick=&#123;handleOpenModal&#125;</span><br></pre></td></tr></table></figure></p>
<p>在电影卡片中再插入一个按钮。使得点击该按钮，可以展现影片的详细信息，在<code>components/MovieCard.tsx</code>中加入以下的代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; openModal &#125; = <span class="title function_">useInfoModal</span>();</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> openModal(data?.id)&#125;</span></span><br><span class="line"><span class="language-xml">    className=&quot;</span></span><br><span class="line"><span class="language-xml">        cursor-pointer </span></span><br><span class="line"><span class="language-xml">        ml-auto </span></span><br><span class="line"><span class="language-xml">        group/item </span></span><br><span class="line"><span class="language-xml">        w-6 </span></span><br><span class="line"><span class="language-xml">        h-6 </span></span><br><span class="line"><span class="language-xml">        lg:w-10 </span></span><br><span class="line"><span class="language-xml">        lg:h-10 </span></span><br><span class="line"><span class="language-xml">        border-white </span></span><br><span class="line"><span class="language-xml">        border-2 </span></span><br><span class="line"><span class="language-xml">        rounded-full </span></span><br><span class="line"><span class="language-xml">        flex </span></span><br><span class="line"><span class="language-xml">        justify-center </span></span><br><span class="line"><span class="language-xml">        items-center </span></span><br><span class="line"><span class="language-xml">        transition </span></span><br><span class="line"><span class="language-xml">        hover:border-neutral-300&quot;&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">BiChevronDown</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">size</span>=<span class="string">&#123;30&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">className</span>=<span class="string">&quot;text-white group-hover/item:text-neutral-300&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>这样，点击电影卡片上的向下的箭头，就会显示出影片的详细信息。调用我们在本节实现的<code>useInfoModal</code>这个hook即可轻松地实现上述功能。</p>
<p>现在继续修复个人profile中名字始终加载为username的问题。将username改为用户实际的名字。进入<code>components/AccountMenu.tsx</code>中，修改以下的代码：<br><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; data &#125; = <span class="title function_">useCurrentUser</span>();</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;text-white text-sm group-hover/item:underline&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;data?.name&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>即可在个人profile中加载出实际的用户名。</p>
<h2 id="Vercel-Deployment"><a href="#Vercel-Deployment" class="headerlink" title="Vercel Deployment"></a>Vercel Deployment</h2><p>可以同时复制并粘贴多行命令，命令行会自动逐一执行这些命令。要想在vercel上部署，要确保没有warning。要解决所有warning，只需要在<code>.eslintrc.json</code>中加入代码：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;rules&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;@next/next/no-img-element&quot;</span><span class="punctuation">:</span> <span class="string">&quot;off&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>然后在命令行中输入：<code>npm run lint</code>，即可得到：<code>No ESLint warnings or errors</code>。此时所有warning就都被消去了。</p>
<p>注册vercel时，注意用github账号注册vercel，否则需要将账号绑定到github。进入vercel，点击add new，选中想要导入的github仓库，点击import，在configure project页面添加一些environment variables，即将原本项目中.env文件中的各个环境变量（除去NEXTAUTH_URL外）填入即可。</p>
<p>然后点击deploy即可。部署大概需要两三分钟的时间。部署以后，就可以直接通过域名访问我们的项目的网页。我发现要在本地启动项目，即运行命令：<code>npm run dev</code>，才能实现正常的登录功能。尚不清楚为什么，按理来说部署到云平台后就本地的服务就不需要启动了。</p>
<p>目前该问题依然无法解决，而且似乎部署在vercel上的项目无法正常进行google/github oauth验证登录，尚不明白原因，但不再浪费时间去尝试。至少本项目在本地是能够成功运行的，我将本地的项目回滚到了<a target="_blank" rel="noopener" href="https://github.com/yfchenkeepgoing/Netflix_clone/commit/5b14e5cd38afa0d138759bf1b9cce77530761cb3">fix prisma error when deploying</a>的版本。通过链接：<a href="http://localhost:33350可以正常进行oauth登录，注册和邮箱密码登录。">http://localhost:33350可以正常进行oauth登录，注册和邮箱密码登录。</a></p>
<p>尝试在vercel上重新部署本应用，现在发现账号密码登录和github oauth登录都可以正常使用了（不需要在本地启动项目，项目直接在vercel上运行），但google oauth还是无法正常运行，我猜测是账号邮箱重复的问题，可以在数据库中查看并验证我的猜测。实际上应该不是账号邮箱重复的问题，就是哪一步配置不对或者网站抽风，不管了。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Frontend/" rel="tag"># Frontend</a>
              <a href="/tags/React/" rel="tag"># React</a>
              <a href="/tags/Tailwind-CSS/" rel="tag"># Tailwind CSS</a>
              <a href="/tags/Next-JS/" rel="tag"># Next.JS</a>
              <a href="/tags/Prisma/" rel="tag"># Prisma</a>
              <a href="/tags/MongoDB/" rel="tag"># MongoDB</a>
              <a href="/tags/NextAuth/" rel="tag"># NextAuth</a>
              <a href="/tags/Vercel/" rel="tag"># Vercel</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/02/20/Day-17-Leetcode-110-257-404/" rel="prev" title="Day 17 | Leetcode 110, 257, 404">
      <i class="fa fa-chevron-left"></i> Day 17 | Leetcode 110, 257, 404
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/02/27/Experiences-of-OAs/" rel="next" title="Experiences of OAs">
      Experiences of OAs <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Netflix-Clone"><span class="nav-number">1.</span> <span class="nav-text">Netflix Clone</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#tech-stack"><span class="nav-number">1.1.</span> <span class="nav-text">tech stack</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#function-overview"><span class="nav-number">1.2.</span> <span class="nav-text">function overview</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Environment-setup"><span class="nav-number">1.3.</span> <span class="nav-text">Environment setup</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#create-project"><span class="nav-number">1.3.1.</span> <span class="nav-text">create project</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#setup-tailwind"><span class="nav-number">1.3.2.</span> <span class="nav-text">setup tailwind</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Auth-Screen-UI"><span class="nav-number">1.4.</span> <span class="nav-text">Auth Screen UI</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NextAuth-Prisma-Mongo-Setup"><span class="nav-number">1.5.</span> <span class="nav-text">NextAuth, Prisma, Mongo Setup</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Google-and-Github-OAuth"><span class="nav-number">1.6.</span> <span class="nav-text">Google and Github OAuth</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Protecting-routes-Profiles-screen"><span class="nav-number">1.7.</span> <span class="nav-text">Protecting routes, Profiles screen</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Navagation-Component"><span class="nav-number">1.8.</span> <span class="nav-text">Navagation Component</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Billboard-Component-Random-Movie-Endpoint"><span class="nav-number">1.9.</span> <span class="nav-text">Billboard Component, Random Movie Endpoint</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%A5%E5%85%85"><span class="nav-number">1.10.</span> <span class="nav-text">补充</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#async"><span class="nav-number">1.10.1.</span> <span class="nav-text">async</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#await"><span class="nav-number">1.10.2.</span> <span class="nav-text">await</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">1.10.3.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Movie-List-amp-Movie-Card-Components-Movies-Endpoint-Cool-hover-effect"><span class="nav-number">1.11.</span> <span class="nav-text">Movie List &amp; Movie Card Components, Movies Endpoint, Cool hover effect</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Favourites-My-List-functionality"><span class="nav-number">1.12.</span> <span class="nav-text">Favourites &#x2F; My List functionality</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Play-Button-Video-Player-Single-Movie-Endpoint"><span class="nav-number">1.13.</span> <span class="nav-text">Play Button, Video Player, Single Movie Endpoint</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Info-Modal-Component"><span class="nav-number">1.14.</span> <span class="nav-text">Info Modal Component</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Vercel-Deployment"><span class="nav-number">1.15.</span> <span class="nav-text">Vercel Deployment</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Yifan Chen"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Yifan Chen</p>
  <div class="site-description" itemprop="description">主要记录算法和web开发方面的心得体会</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">76</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yifan Chen</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '1495b8dcfa58a185e440',
      clientSecret: 'f073065ea2e5270367cd8792371419093833c1f3',
      repo        : 'yfchenkeepgoing.github.io',
      owner       : 'yfchenkeepgoing',
      admin       : ['yfchenkeepgoing'],
      id          : '8e2304c77eedf361e96cf44bcdc8886f',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

    </div>
</body>
</html>
